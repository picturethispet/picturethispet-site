<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Calendar Management | Picture This Pet</title>
  <meta name="description" content="Manage availability and pop-up events for Picture This Pet.">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --orange: #F47C2C;
      --gold: #FDB75E;
      --dark-brown: #4B2E1E;
      --available-green: #10b981;
      --booked-red: #ef4444;
      --popup-yellow: #f59e0b;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      overflow-x: hidden;
      scrollbar-width: none;
      -ms-overflow-style: none;
      scroll-behavior: smooth;
    }

    html::-webkit-scrollbar {
      width: 0;
      height: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: white;
      background-image: url('assets/images/main_background_allsystem.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      overflow-x: hidden;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    @keyframes moveBackground {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    header {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.01rem 1.5rem;
      padding-top: calc(0.01rem + env(safe-area-inset-top));
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: cover;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 32px rgba(0,0,0, 0.3);
      border-bottom: 1px solid rgba(255,255,255, 0.1);
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
      height: calc(110px + env(safe-area-inset-top));
    }

    .desktop-logo {
      height: 100px;
    }

    .logo-link {
      display: flex;
      align-items: center;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .logo-link:hover {
      opacity: 0.8;
      transform: scale(1.02);
    }

    .site-nav {
      display: flex;
      align-items: center;
      margin-left: auto;
    }

    .site-nav a:not(.book-btn) {
      margin-left: 1rem;
      text-decoration: none;
      font-weight: 600;
      color: white;
      transition: all 0.3s ease;
      padding: 0.5rem 1rem;
      border-radius: 8px;
    }

    .site-nav a:not(.book-btn):hover {
      background: rgba(255,255,255, 0.1);
      transform: translateY(-1px);
    }

    .book-btn {
      background: linear-gradient(135deg, var(--orange), var(--gold));
      color: white;
      padding: 0.8rem 2rem;
      border: none;
      border-radius: 999px;
      font-weight: 900;
      font-size: 1.2rem;
      text-decoration: none;
      margin-left: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(244,124,44, 0.3);
    }

    .book-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(244,124,44, 0.4);
    }

    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .mobile-menu-btn:hover {
      transform: scale(1.1);
    }

    main {
      margin-top: 110px;
      flex: 1;
      padding: 4rem 1rem;
    }

    #calendar-management {
      max-width: 1000px;
      margin: 0 auto;
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      border-radius: 24px;
      box-shadow: 0 20px 40px rgba(0,0,0, 0.2);
      padding: 3rem;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255, 0.1);
      animation: fadeInUp 1s ease-out;
      display: flex;
      flex-direction: column;
      min-height: 500px;
    }

    #calendar-management h2 {
      font-family: 'Playfair Display', serif;
      font-size: 2.5rem;
      font-weight: 700;
      color: white;
      text-shadow: 0 2px 8px rgba(0,0,0, 0.3);
      margin-bottom: 1.5rem;
      text-align: center;
    }

    #calendar-management p {
      font-size: 1.2rem;
      line-height: 1.6;
      color: rgba(255,255,255, 0.9);
      margin-bottom: 2rem;
      text-align: center;
    }

    .tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      justify-content: center;
    }

    .tab {
      background: rgba(255,255,255, 0.1);
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .tab:hover, .tab.active {
      background: linear-gradient(135deg, var(--orange), var(--gold));
      transform: translateY(-2px);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: rgba(255,255,255, 0.9);
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 0.8rem;
      font-size: 1rem;
      color: white;
      background: rgba(255,255,255, 0.1);
      border: 2px solid rgba(255,255,255, 0.3);
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: var(--gold);
      background: rgba(255,255,255, 0.15);
    }

    .form-group select[multiple] {
      height: 120px;
    }

    .submit-btn {
      background: linear-gradient(135deg, var(--orange), var(--gold));
      color: white;
      padding: 1rem 2.5rem;
      border: none;
      border-radius: 999px;
      font-weight: 900;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(244,124,44, 0.3);
      margin-top: 1rem;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(244,124,44, 0.4);
    }

    .calendar-container {
      background: rgba(255,255,255, 0.05);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1rem 0;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .calendar-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: white;
    }

    .calendar-nav {
      display: flex;
      gap: 0.5rem;
    }

    .nav-button {
      background: rgba(255,255,255, 0.1);
      border: 1px solid rgba(255,255,255, 0.3);
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nav-button:hover {
      background: rgba(255,255,255, 0.2);
      transform: scale(1.05);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
      background: rgba(255,255,255, 0.1);
      border-radius: 12px;
      overflow: hidden;
    }

    .calendar-day-header {
      background: rgba(255,255,255, 0.15);
      padding: 0.8rem;
      text-align: center;
      font-weight: 600;
      font-size: 0.9rem;
      color: rgba(255,255,255, 0.9);
    }

    .calendar-day {
      background: rgba(255,255,255, 0.05);
      padding: 0.8rem;
      text-align: center;
      min-height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    .calendar-day.other-month,
    .calendar-day.past {
      color: rgba(255,255,255, 0.3);
      pointer-events: none;
    }

    .calendar-day.available {
      background: rgba(16,185,129, 0.2);
      border: 2px solid var(--available-green);
      color: white;
    }

    .calendar-day.popup {
      background: rgba(245,158,11, 0.2);
      border: 2px solid var(--popup-yellow);
      color: white;
    }

    .calendar-day.unavailable {
      background: rgba(239,68,68, 0.2);
      border: 2px solid var(--booked-red);
      color: rgba(255,255,255, 0.7);
      pointer-events: none;
    }

    .calendar-day:hover:not(.past):not(.unavailable) {
      background: rgba(255,255,255, 0.1);
    }

    .slot-details {
      display: none;
      position: absolute;
      background: rgba(0,0,0, 0.8);
      color: white;
      padding: 0.5rem;
      border-radius: 8px;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      font-size: 0.8rem;
      white-space: nowrap;
    }

    .calendar-day:hover .slot-details {
      display: block;
    }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .action-btn {
      background: rgba(255,255,255, 0.1);
      color: white;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .action-btn:hover {
      background: rgba(255,255,255, 0.2);
      transform: translateY(-1px);
    }

    footer {
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      border-top: 1px solid rgba(255,255,255, 0.1);
      padding: 2rem 1.5rem;
      color: rgba(255,255,255, 0.5);
      font-size: 0.9rem;
    }

    .footer-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      margin-bottom: 1.5rem;
    }

    .footer-section {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .footer-section h4 {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      font-size: 1.2rem;
      color: white;
      margin-bottom: 1rem;
    }

    .footer-section a {
      color: rgba(255,255,255, 0.7);
      text-decoration: none;
      display: block;
      margin-bottom: 0.5rem;
      transition: color 0.3s ease;
    }

    .footer-section a:hover {
      color: var(--gold);
    }

    .payment-methods {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .payment-icon {
      width: 40px;
      height: 25px;
      object-fit: contain;
      opacity: 0.7;
      transition: opacity 0.3s ease;
    }

    .payment-icon:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    .footer-bottom {
      text-align: center;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255,255,255, 0.1);
    }

    @media (max-width: 768px) {
      header {
        height: 80px;
        padding: 0.5rem 1rem;
        padding-top: calc(0.5rem + env(safe-area-inset-top));
        height: calc(80px + env(safe-area-inset-top));
      }

      .desktop-logo {
        height: 48px;
      }

      .site-nav {
        display: none;
        flex-direction: column;
        background-image: url('assets/images/ani_bkgd_cool.png');
        background-size: 100% 100%;
        background-position: center;
        position: absolute;
        top: calc(80px + env(safe-area-inset-top));
        right: 0;
        width: 100%;
        text-align: right;
        padding: 1rem;
        z-index: 999;
        border-top: 1px solid rgba(255,255,255, 0.1);
        backdrop-filter: blur(12px);
      }

      .site-nav.active {
        display: flex;
      }

      .site-nav.active a {
        margin: 0.5rem 0;
        font-size: 1.2rem;
        padding: 0.5rem 1rem;
      }

      .book-btn {
        padding: 0.6rem 1.5rem;
        font-size: 1rem;
        margin-left: 0;
      }

      .mobile-menu-btn {
        display: block;
      }

      main {
        margin-top: calc(80px + env(safe-area-inset-top));
        padding: 2rem 1rem;
      }

      #calendar-management {
        padding: 2rem;
        min-height: 400px;
      }

      #calendar-management h2 {
        font-size: 2rem;
      }

      #calendar-management p {
        font-size: 1rem;
      }

      .tabs {
        flex-direction: column;
        align-items: center;
      }

      .calendar-day {
        font-size: 0.8rem;
        padding: 0.6rem;
        min-height: 40px;
      }

      .calendar-day-header {
        font-size: 0.8rem;
        padding: 0.6rem;
      }

      .submit-btn {
        padding: 0.8rem 2rem;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <a href="/" class="logo-link" aria-label="PictureThisPet Home">
      <img src="assets/images/headerlogowarm.png" alt="PictureThisPet Logo" class="desktop-logo" />
    </a>
    <nav class="site-nav">
      <a href="/" aria-label="Home page">Home</a>
      <a href="/availability.html" aria-label="Availability page">Availability</a>
      <a href="/locations.html" aria-label="Locations page">Locations</a>
      <a href="/pricing" aria-label="Pricing page">Pricing</a>
      <a href="/contact" aria-label="Contact page">Contact</a>
      <a href="/cart.html#session-builder" class="book-btn" aria-label="Book a session">Book Now</a>
    </nav>
    <button class="mobile-menu-btn" aria-label="Toggle mobile menu" onclick="toggleMenu()">â˜°</button>
  </header>

  <main>
    <section id="calendar-management">
      <h2>Calendar Management</h2>
      <p>Manage availability and pop-up events for PictureThisPet ðŸ“…</p>
      <div class="tabs">
        <div class="tab active" onclick="showTab('create-availability')">Create Availability</div>
        <div class="tab" onclick="showTab('manage-slots')">Manage Slots</div>
        <div class="tab" onclick="showTab('create-popup')">Create Pop-Up</div>
      </div>
      <div id="create-availability" class="tab-content active">
        <div class="form-group">
          <label for="startDate">Start Date</label>
          <input type="date" id="startDate" required>
        </div>
        <div class="form-group">
          <label for="endDate">End Date</label>
          <input type="date" id="endDate" required>
        </div>
        <div class="form-group">
          <label for="startTime">Start Time</label>
          <input type="time" id="startTime" value="08:00" required>
        </div>
        <div class="form-group">
          <label for="endTime">End Time</label>
          <input type="time" id="endTime" value="17:00" required>
        </div>
        <div class="form-group">
          <label for="locations">Locations (hold Ctrl for multiple)</label>
          <select id="locations" multiple required>
            <option value="Cheesman Park">Cheesman Park</option>
            <option value="City Park">City Park</option>
            <option value="Dog Boarding Place">Dog Boarding Place</option>
            <option value="Hiking Spot">Hiking Spot</option>
          </select>
        </div>
        <div class="form-group">
          <label for="sessionTypes">Session Types (hold Ctrl for multiple)</label>
          <select id="sessionTypes" multiple required>
            <option value="Mini">Mini</option>
            <option value="Full">Full</option>
            <option value="Portrait Day">Portrait Day</option>
            <option value="Adventure Package">Adventure Package</option>
          </select>
        </div>
        <button class="submit-btn" onclick="createAvailability()">Create Availability</button>
      </div>
      <div id="manage-slots" class="tab-content">
        <div class="calendar-container">
          <div class="calendar-header">
            <h3 class="calendar-title" id="calendarMonth">June 2025</h3>
            <div class="calendar-nav">
              <button class="nav-button" onclick="previousMonth()">â€¹</button>
              <button class="nav-button" onclick="nextMonth()">â€º</button>
            </div>
          </div>
          <div class="calendar-grid" id="calendarGrid"></div>
        </div>
      </div>
      <div id="create-popup" class="tab-content">
        <div class="form-group">
          <label for="popupName">Pop-Up Name</label>
          <input type="text" id="popupName" placeholder="e.g., Portrait Day Summer 2025" required>
        </div>
        <div class="form-group">
          <label for="popupDate">Date</label>
          <input type="date" id="popupDate" required>
        </div>
        <div class="form-group">
          <label for="popupTime">Time</label>
          <input type="time" id="popupTime" required>
        </div>
        <div class="form-group">
          <label for="popupLocation">Location</label>
          <select id="popupLocation" required>
            <option value="Dog Boarding Place">Dog Boarding Place</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label for="popupSessionType">Session Type</label>
          <select id="popupSessionType" required>
            <option value="Portrait Day">Portrait Day</option>
            <option value="Adventure Package">Adventure Package</option>
          </select>
        </div>
        <div class="form-group">
          <label for="popupDescription">Description</label>
          <textarea id="popupDescription" rows="4" placeholder="Describe the pop-up event"></textarea>
        </div>
        <button class="submit-btn" onclick="createPopUp()">Create Pop-Up</button>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-container">
      <div class="footer-section">
        <h4>Contact Us</h4>
        <a href="mailto:info@picturethispet.co" aria-label="Email us">Email Us</a>
        <a href="https://picturethispet.co" aria-label="Visit our website">picturethispet.co</a>
      </div>
      <div class="footer-section socials">
        <h4>Connect</h4>
        <a href="https://instagram.com/picturethispet" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Instagram">Instagram</a>
        <a href="/subscribe" aria-label="Subscribe to our newsletter">Subscribe</a>
      </div>
      <div class="footer-section">
        <h4>We Accept</h4>
        <div class="payment-methods">
          <img src="assets/images/payments/visa.png" alt="Visa" class="payment-icon" />
          <img src="assets/images/payments/mastercard.png" alt="MasterCard" class="payment-icon" />
          <img src="assets/images/payments/amex.png" alt="American Express" class="payment-icon" />
          <img src="assets/images/payments/discover.png" alt="Discover" class="payment-icon" />
          <img src="assets/images/payments/applepay.png" alt="Apple Pay" class="payment-icon" />
          <img src="assets/images/payments/googlepay.png" alt="Google Pay" class="payment-icon" />
          <img src="assets/images/payments/samsungpay.png" alt="Samsung Pay" class="payment-icon" />
          <img src="assets/images/payments/amazonpay.png" alt="Amazon Pay" class="payment-icon" />
          <img src="assets/images/payments/klarna.png" alt="Klarna" class="payment-icon" />
          <img src="assets/images/payments/affirm.png" alt="Affirm" class="payment-icon" />
          <img src="assets/images/payments/afterpay.png" alt="Afterpay" class="payment-icon" />
          <img src="assets/images/payments/cashapp.png" alt="Cash App" class="payment-icon" />
          <img src="assets/images/payments/paypal.png" alt="PayPal" class="payment-icon" />
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>Â© 2025 PictureThisPet. All rights reserved. | v1.0.9 | Last updated: 01:47 AM MDT, May 26, 2025 | <a href="/site-creation" class="site-creation-link" style="color: var(--gold); text-decoration: underline;" aria-label="Learn how AI built this site">AI built my site. Find out How!</a></p>
    </div>
  </footer>

  <script>
    // Airtable configuration
    const AIRTABLE_API_KEY = 'YOUR_AIRTABLE_API_KEY'; // Replace with your API key
    const AIRTABLE_BASE_ID = 'YOUR_AIRTABLE_BASE_ID'; // Replace with your Base ID
    const CALENDAR_TABLE = 'Calendar';
    const POPUPS_TABLE = 'PopUps';
    const SESSION_TYPES_TABLE = 'SessionTypes';

    let currentMonth = new Date('2025-06-01');
    let slots = [];

    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add('active');
      document.getElementById(tabId).classList.add('active');
      if (tabId === 'manage-slots') {
        renderCalendar();
      }
    }

    async function createAvailability() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const startTime = document.getElementById('startTime').value;
      const endTime = document.getElementById('endTime').value;
      const locations = Array.from(document.getElementById('locations').selectedOptions).map(opt => opt.value);
      const sessionTypes = Array.from(document.getElementById('sessionTypes').selectedOptions).map(opt => opt.value);

      if (!startDate || !endDate || !startTime || !endTime || !locations.length || !sessionTypes.length) {
        alert('Please fill all fields.');
        return;
      }

      const start = new Date(startDate);
      const end = new Date(endDate);
      const startHour = parseInt(startTime.split(':')[0]);
      const startMinute = parseInt(startTime.split(':')[1]);
      const endHour = parseInt(endTime.split(':')[0]);
      const endMinute = parseInt(endTime.split(':')[1]);

      try {
        for (let date = new Date(start); date <= end; date.setDate(date.getDate() + 1)) {
          for (let hour = startHour; hour <= endHour; hour++) {
            for (let minute = (hour === startHour ? startMinute : 0); minute <= (hour === endHour ? endMinute : 30); minute += 30) {
              const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
              for (const location of locations) {
                for (const sessionType of sessionTypes) {
                  await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${CALENDAR_TABLE}`, {
                    method: 'POST',
                    headers: {
                      Authorization: `Bearer ${AIRTABLE_API_KEY}`,
                      'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                      fields: {
                        Date: date.toISOString().split('T')[0],
                        Time: time,
                        Location: location,
                        Status: 'Available',
                        SessionType: [sessionType]
                      }
                    })
                  });
                }
              }
            }
          }
        }
        alert('Availability created successfully!');
      } catch (error) {
        console.error('Error creating availability:', error);
        alert('Failed to create availability. Check console for details.');
      }
    }

    async function createPopUp() {
      const popupName = document.getElementById('popupName').value;
      const popupDate = document.getElementById('popupDate').value;
      const popupTime = document.getElementById('popupTime').value;
      const popupLocation = document.getElementById('popupLocation').value;
      const popupSessionType = document.getElementById('popupSessionType').value;
      const popupDescription = document.getElementById('popupDescription').value;

      if (!popupName || !popupDate || !popupTime || !popupLocation || !popupSessionType) {
        alert('Please fill all required fields.');
        return;
      }

      try {
        const popupResponse = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${POPUPS_TABLE}`, {
          method: 'POST',
          headers: {
            Authorization: `Bearer ${AIRTABLE_API_KEY}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            fields: {
              PopUpName: popupName,
              Date: popupDate,
              Location: popupLocation,
              Description: popupDescription,
              SessionType: [popupSessionType]
            }
          })
        });
        const popupData = await popupResponse.json();
        const popupId = popupData.id;

        await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${CALENDAR_TABLE}`, {
          method: 'POST',
          headers: {
            Authorization: `Bearer ${AIRTABLE_API_KEY}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            fields: {
              Date: popupDate,
              Time: popupTime,
              Location: popupLocation,
              Status: 'PopUp',
              SessionType: [popupSessionType],
              PopUpID: [popupId]
            }
          })
        });

        alert('Pop-up created successfully!');
      } catch (error) {
        console.error('Error creating pop-up:', error);
        alert('Failed to create pop-up. Check console for details.');
      }
    }

    async function fetchSlots() {
      try {
        const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${CALENDAR_TABLE}?view=Grid%20view`, {
          headers: { Authorization: `Bearer ${AIRTABLE_API_KEY}` }
        });
        const data = await response.json();
        slots = data.records.map(record => ({
          id: record.id,
          date: record.fields.Date,
          time: record.fields.Time,
          location: record.fields.Location,
          status: record.fields.Status,
          sessionType: record.fields.SessionType || [],
          popupId: record.fields.PopUpID || []
        }));
        renderCalendar();
      } catch (error) {
        console.error('Error fetching slots:', error);
        alert('Failed to load slots.');
      }
    }

    function renderCalendar() {
      const calendarGrid = document.getElementById('calendarGrid');
      const calendarMonth = document.getElementById('calendarMonth');
      calendarMonth.textContent = new Intl.DateTimeFormat('en-US', { month: 'long', year: 'numeric' }).format(currentMonth);

      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDayOfWeek = firstDay.getDay();

      let html = '';
      const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      dayHeaders.forEach(day => {
        html += `<div class="calendar-day-header">${day}</div>`;
      });

      for (let i = 0; i < startingDayOfWeek; i++) {
        html += '<div class="calendar-day other-month"></div>';
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(year, month, day);
        const dateStr = date.toISOString().split('T')[0];
        const isPast = date < new Date('2025-05-26');
        const daySlots = slots.filter(slot => slot.date === dateStr);
        let statusClass = 'unavailable';
        let slotDetails = 'No availability';
        let slotIds = [];

        if (daySlots.length > 0) {
          if (daySlots.some(slot => slot.status === 'PopUp')) {
            statusClass = 'popup';
            slotDetails = daySlots.map(slot => `${slot.time} (${slot.location}, ${slot.sessionType.join(', ')})`).join('<br>');
            slotIds = daySlots.map(slot => slot.id);
          } else if (daySlots.some(slot => slot.status === 'Available')) {
            statusClass = 'available';
            slotDetails = daySlots.map(slot => `${slot.time} (${slot.location}, ${slot.sessionType.join(', ')})`).join('<br>');
            slotIds = daySlots.map(slot => slot.id);
          }
        }

        html += `
          <div class="calendar-day ${isPast ? 'past' : statusClass}" data-date="${dateStr}" ${!isPast && statusClass !== 'unavailable' ? `onclick="editSlot('${dateStr}', '${slotIds.join(',')}')"` : ''}>
            ${day}
            ${statusClass !== 'unavailable' ? `<div class="slot-details">${slotDetails}</div>` : ''}
          </div>
        `;
      }

      calendarGrid.innerHTML = html;
    }

    function previousMonth() {
      currentMonth.setMonth(currentMonth.getMonth() - 1);
      fetchSlots();
    }

    function nextMonth() {
      currentMonth.setMonth(currentMonth.getMonth() + 1);
      fetchSlots();
    }

    async function editSlot(date, slotIds) {
      const slotIdArray = slotIds.split(',').filter(id => id);
      if (!slotIdArray.length) return;

      const slot = slots.find(s => slotIdArray.includes(s.id));
      const confirmEdit = prompt(`Edit slot for ${date} at ${slot.time} (${slot.location}, ${slot.sessionType.join(', ')})? Enter new time (HH:mm) or leave blank to keep current.`);
      const confirmDelete = confirm('Delete this slot?');

      try {
        if (confirmDelete) {
          for (const id of slotIdArray) {
            await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${CALENDAR_TABLE}/${id}`, {
              method: 'DELETE',
              headers: { Authorization: `Bearer ${AIRTABLE_API_KEY}` }
            });
          }
          alert('Slot deleted successfully!');
        } else if (confirmEdit) {
          for (const id of slotIdArray) {
            await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${CALENDAR_TABLE}/${id}`, {
              method: 'PATCH',
              headers: {
                Authorization: `Bearer ${AIRTABLE_API_KEY}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                fields: { Time: confirmEdit }
              })
            });
          }
          alert('Slot updated successfully!');
        }
        fetchSlots();
      } catch (error) {
        console.error('Error editing slot:', error);
        alert('Failed to edit slot.');
      }
    }

    function toggleMenu() {
      const nav = document.querySelector('.site-nav');
      nav.classList.toggle('active');
    }

    document.addEventListener('DOMContentLoaded', function() {
      console.log('âœ… Calendar Management page loaded - v1.0.9');
      fetchSlots();
    });
  </script>
</body>
</html>
