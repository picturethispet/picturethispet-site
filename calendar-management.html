<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calendar Management | Picture This Pet</title>
  <meta name="description" content="Manage your studio calendar and events.">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  
  <style>
    :root {
      --orange: #F47C2C;
      --gold: #FDB75E;
      --dark-brown: #4B2E1E;
      --available-green: #10b981;
      --booked-red: #ef4444;
      --soft-hold-yellow: #f59e0b;
      --admin-purple: #8b5cf6;
      --admin-blue: #3b82f6;
      --popup-event-purple: #a78bfa; /* New color for pop-up events */
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      overflow-x: hidden;
      scrollbar-width: thin;
      scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
    }

    html::-webkit-scrollbar {
      width: 8px;
    }

    html::-webkit-scrollbar-track {
      background: transparent;
    }

    html::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 4px;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: white;
      background: none;
    }

    @keyframes moveBackground {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* === LAYOUT === */
    .admin-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      grid-template-rows: auto 1fr auto;
      min-height: 100vh;
      background-image: url("assets/images/main_background_allsystem.png");
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
    }

    /* === HEADER STYLES === */
    header {
      grid-column: 1 / -1;
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      backdrop-filter: blur(8px);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 1000;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 2rem;
    }

    .logo-small {
      height: 50px;
    }

    .header-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      font-weight: 700;
      color: white;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .sync-status {
      background: rgba(255, 255, 255, 0.1);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.85rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .sync-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--available-green);
      animation: pulse 2s infinite;
    }

    .sync-indicator.disconnected {
      background: var(--booked-red);
    }

    .admin-user {
      background: rgba(255, 255, 255, 0.1);
      padding: 0.8rem 1.5rem;
      border-radius: 25px;
      font-size: 0.9rem;
      font-weight: 600;
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .logout-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 0.7rem 1.2rem;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 80px;
    }

    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
    }

    /* === SIDEBAR === */
    .admin-sidebar {
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      padding: 2rem 0;
      overflow-y: auto;
    }

    .nav-section {
      margin-bottom: 2rem;
    }

    .nav-section-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.6);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 0 1.5rem;
      margin-bottom: 0.5rem;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.5rem;
      color: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
      min-height: 48px;
      text-decoration: none;
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .nav-item.active {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      border-left-color: var(--gold);
    }

    .nav-icon {
      font-size: 1.2rem;
      width: 20px;
      text-align: center;
    }

    .nav-badge {
      background: var(--booked-red);
      color: white;
      font-size: 0.7rem;
      padding: 0.2rem 0.5rem;
      border-radius: 10px;
      margin-left: auto;
    }

    /* === MAIN CONTENT === */
    .admin-main {
      padding: 2rem;
      overflow-y: auto;
      max-height: calc(100vh - 100px - 120px);
    }

    /* === CARDS === */
    .admin-card {
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      border-radius: 24px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      padding: 2rem;
      color: white;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 2rem;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .card-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      font-weight: 700;
      color: white;
    }

    .card-actions {
      display: flex;
      gap: 0.5rem;
    }

    /* === BUTTONS === */
    .btn {
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      min-height: 48px;
      min-width: 80px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--orange), var(--gold));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(244, 124, 44, 0.3);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .btn-small {
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
      min-height: 40px;
      min-width: 60px;
    }

    .btn-icon {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      padding: 0.6rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 40px;
      min-width: 40px;
    }

    .btn-icon:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* === CALENDAR === */
    .calendar-container {
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: 2rem;
    }

    .calendar-main {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .calendar-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
    }

    .calendar-nav {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .nav-button {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.1rem;
    }

    .nav-button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.05);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 1.5rem;
    }

    .calendar-day-header {
      background: rgba(255, 255, 255, 0.1);
      padding: 1rem 0.5rem;
      text-align: center;
      font-weight: 600;
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.8);
    }

    .calendar-day {
      background: rgba(255, 255, 255, 0.05);
      padding: 0.8rem 0.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      min-height: 60px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      position: relative;
      font-weight: 500;
    }

    .calendar-day:hover:not(.past):not(.other-month) {
      background: rgba(255, 255, 255, 0.15);
      transform: scale(1.02);
    }

    .calendar-day.other-month {
      color: rgba(255, 255, 255, 0.3);
      cursor: default;
    }

    .calendar-day.past {
      color: rgba(255, 255, 255, 0.3);
      cursor: default;
    }

    .calendar-day.available {
      background: rgba(16, 185, 129, 0.2);
      border: 1px solid rgba(16, 185, 129, 0.5);
      color: white;
    }

    .calendar-day.booked {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.5);
      color: rgba(255, 255, 255, 0.9);
    }

    .calendar-day.popup-event {
      background: rgba(167, 139, 250, 0.2);
      border: 1px solid rgba(167, 139, 250, 0.5);
      color: rgba(255, 255, 255, 0.9);
    }

    .calendar-day.blocked {
      background: rgba(100, 100, 100, 0.3);
      border: 1px solid rgba(150, 150, 150, 0.5);
      color: rgba(255, 255, 255, 0.7);
    }

    .calendar-day.soft-hold {
      background: rgba(245, 158, 11, 0.2);
      border: 1px solid rgba(245, 158, 11, 0.5);
      color: rgba(255, 255, 255, 0.9);
    }

    .calendar-day.selected {
      background: linear-gradient(135deg, var(--admin-purple), #ec4899);
      border: 2px solid #ec4899;
      color: white;
      transform: scale(1.05);
    }

    .day-events {
      font-size: 0.7rem;
      margin-top: 2px;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .calendar-legend {
      display: flex;
      gap: 1.5rem;
      justify-content: center;
      flex-wrap: wrap;
      font-size: 0.85rem;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .legend-dot.available {
      background: rgba(16, 185, 129, 0.7);
    }

    .legend-dot.booked {
      background: rgba(239, 68, 68, 0.7);
    }

    .legend-dot.popup-event {
      background: rgba(167, 139, 250, 0.7);
    }

    .legend-dot.blocked {
      background: rgba(100, 100, 100, 0.7);
    }

    .legend-dot.soft-hold {
      background: rgba(245, 158, 11, 0.7);
    }

    /* === SESSION PANEL === */
    .session-panel {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .session-panel h3 {
      font-family: 'Playfair Display', serif;
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: white;
    }

    .session-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: white;
      font-size: 0.9rem;
    }

    .form-input {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 0.9rem;
    }

    .form-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 2px rgba(253, 183, 94, 0.2);
    }

    .form-select {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 0.9rem;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    /* === CONTEXT MENU === */
    .context-menu {
      position: fixed;
      background: rgba(20, 20, 20, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 0.5rem 0;
      min-width: 200px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
      z-index: 2000;
      display: none;
    }

    .context-menu-item {
      padding: 0.8rem 1.2rem;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-size: 0.9rem;
      min-height: 48px;
    }

    .context-menu-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .context-menu-item.disabled {
      color: rgba(255, 255, 255, 0.4);
      cursor: not-allowed;
    }

    .context-menu-separator {
      height: 1px;
      background: rgba(255, 255, 255, 0.1);
      margin: 0.5rem 0;
    }

    /* === MODALS === */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      z-index: 3000;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .modal {
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
      padding: 2rem;
      color: white;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .modal-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
    }

    .modal-close {
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.7);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.3s ease;
      min-height: 40px;
      min-width: 40px;
    }

    .modal-close:hover {
      color: white;
    }

    .modal-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 2rem;
    }

    /* === FOOTER STYLES === */
    footer {
      grid-column: 1 / -1;
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding: 2rem 1.5rem;
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.9rem;
    }

    .footer-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      margin-bottom: 1.5rem;
    }

    .footer-section {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .footer-section h4 {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      font-size: 1.2rem;
      color: white;
      margin-bottom: 1rem;
    }

    .footer-section a {
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      display: block;
      margin-bottom: 0.5rem;
      transition: color 0.3s ease;
      min-height: 40px;
    }

    .footer-section a:hover {
      color: var(--gold);
    }

    .payment-methods {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .payment-icon {
      width: 40px;
      height: 25px;
      object-fit: contain;
      opacity: 0.7;
      transition: opacity 0.3s ease;
    }

    .payment-icon:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    .footer-bottom {
      text-align: center;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* === RESPONSIVE === */
    @media (max-width: 1024px) {
      .admin-layout {
        grid-template-columns: 60px 1fr;
      }

      .admin-sidebar {
        padding: 1rem 0;
      }

      .nav-item {
        padding: 1rem 0.8rem;
        justify-content: center;
      }

      .nav-item span:not(.nav-icon) {
        display: none;
      }

      .nav-section-title {
        display: none;
      }

      .calendar-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .admin-layout {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto 1fr auto;
      }

      .admin-sidebar {
        background: rgba(0, 0, 0, 0.9);
        position: fixed;
        top: 0;
        left: -100%;
        width: 280px;
        height: 100vh;
        z-index: 4000;
        transition: left 0.3s ease;
      }

      .admin-sidebar.open {
        left: 0;
      }

      .mobile-menu-btn {
        display: block;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .mobile-menu-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .header-title {
        font-size: 1.4rem;
      }

      .admin-main {
        padding: 1rem;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .modal {
        padding: 1.5rem;
        margin: 1rem;
      }

      footer {
        padding: 1.5rem 1rem;
      }

      .footer-container {
        grid-template-columns: 1fr;
        gap: 1.5rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .footer-section {
        align-items: center;
        text-align: center;
      }

      .payment-methods {
        justify-content: center;
      }

      .form-input,
      .form-select {
        padding: 1rem;
        font-size: 1rem;
      }

      .calendar-day {
        min-height: 80px;
        padding: 1rem 0.5rem;
      }

      .day-events {
        font-size: 0.85rem;
      }

      .calendar-legend {
        font-size: 0.95rem;
        gap: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="admin-layout">
    <!-- Header -->
    <header class="admin-header">
      <div class="header-left">
        <button class="mobile-menu-btn" onclick="toggleSidebar()" style="display: none;">‚ò∞</button>
        <img src="assets/images/headerlogowarm.png" alt="PictureThisPet Logo" class="logo-small" />
        <h1 class="header-title">Calendar Management</h1>
      </div>
      <div class="header-right">
        <div class="sync-status">
          <div class="sync-indicator" id="syncIndicator"></div>
          <span id="syncStatus">Google Connected</span>
        </div>
        <div class="admin-user" id="adminUser">Welcome, Admin</div>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </header>

    <!-- Sidebar -->
    <nav class="admin-sidebar" id="adminSidebar">
      <div class="nav-section">
        <div class="nav-section-title">Overview</div>
        <a href="admin.html" class="nav-item">
          <span class="nav-icon">üìä</span>
          <span>Dashboard</span>
        </a>
        <a href="calendar-management.html" class="nav-item active">
          <span class="nav-icon">üìÖ</span>
          <span>Calendar Management</span>
          <span class="nav-badge" id="calendarBadge">0</span>
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Management</div>
        <a href="client-session-management.html" class="nav-item">
          <span class="nav-icon">üë•</span>
          <span>Client & Session Management</span>
        </a>
        <a href="gallery-management.html" class="nav-item">
          <span class="nav-icon">üñºÔ∏è</span>
          <span>Gallery Management</span>
          <span class="nav-badge" id="galleriesBadge">0</span>
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Business</div>
        <a href="business-management.html" class="nav-item">
          <span class="nav-icon">üìà</span>
          <span>Business Management</span>
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">System</div>
        <a href="#" class="nav-item">
          <span class="nav-icon">‚öôÔ∏è</span>
          <span>Settings</span>
        </a>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="admin-main">
      <div class="admin-card">
        <div class="card-header">
          <h2 class="card-title">Session Calendar</h2>
          <div class="card-actions">
            <button class="btn btn-secondary btn-small" onclick="syncCalendar()">üîÑ Sync</button>
            <button class="btn btn-primary btn-small" onclick="openSessionModal('add')">+ Add Session</button>
            <button class="btn btn-primary btn-small" onclick="openPopupEventModal('add')">+ Add Pop-Up Event</button>
          </div>
        </div>

        <div class="calendar-container">
          <div class="calendar-main">
            <div class="calendar-header">
              <h3 class="calendar-title" id="calendarTitle">Loading...</h3>
              <div class="calendar-nav">
                <button class="nav-button" onclick="previousMonth()">‚Äπ</button>
                <button class="nav-button" onclick="nextMonth()">‚Ä∫</button>
              </div>
            </div>

            <div id="calendarContainer">
              <div class="loading-indicator">
                <p>Loading calendar data...</p>
              </div>
            </div>

            <div class="calendar-legend">
              <div class="legend-item">
                <div class="legend-dot available"></div>
                <span>Available</span>
              </div>
              <div class="legend-item">
                <div class="legend-dot booked"></div>
                <span>Session Booked</span>
              </div>
              <div class="legend-item">
                <div class="legend-dot popup-event"></div>
                <span>Pop-Up Event</span>
              </div>
              <div class="legend-item">
                <div class="legend-dot blocked"></div>
                <span>Blocked</span>
              </div>
              <div class="legend-item">
                <div class="legend-dot soft-hold"></div>
                <span>Soft Hold</span>
              </div>
            </div>
          </div>

          <div class="session-panel">
            <h3>Quick Actions</h3>
            <div class="session-form">
              <button class="btn btn-primary" onclick="openSessionModal('add')">üì∏ Add Session</button>
              <button class="btn btn-primary" onclick="openPopupEventModal('add')">üéâ Add Pop-Up Event</button>
              <button class="btn btn-secondary" onclick="openBlockModal()">üö´ Block Date</button>
              <button class="btn btn-secondary" onclick="openFullCalendar()">üìÖ Full Calendar</button>
              <button class="btn btn-secondary" onclick="exportCalendar()">üìÅ Export</button>
            </div>

            <div id="selectedDateInfo" style="display: none; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1);">
              <h4 style="margin-bottom: 1rem; color: var(--gold);">Selected Date</h4>
              <div id="dateDetails"></div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer>
      <div class="footer-container">
        <div class="footer-section">
          <h4>Contact Us</h4>
          <a href="mailto:info@picturethispet.co" aria-label="Email us at info@picturethispet.co">Email Us</a>
          <a href="https://picturethispet.co" aria-label="Visit our website picturethispet.co">picturethispet.co</a>
        </div>
        <div class="footer-section socials">
          <h4>Connect</h4>
          <a href="https://instagram.com/picturethispet" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Instagram">Instagram</a>
          <a href="/subscribe" aria-label="Subscribe to our newsletter">Subscribe</a>
        </div>
        <div class="footer-section">
          <h4>We Accept</h4>
          <div class="payment-methods">
            <img src="assets/images/payments/visa.png" alt="Visa payment accepted" class="payment-icon" />
            <img src="assets/images/payments/mastercard.png" alt="MasterCard payment accepted" class="payment-icon" />
            <img src="assets/images/payments/amex.png" alt="American Express payment accepted" class="payment-icon" />
            <img src="assets/images/payments/discover.png" alt="Discover payment accepted" class="payment-icon" />
            <img src="assets/images/payments/applepay.png" alt="Apple Pay payment accepted" class="payment-icon" />
            <img src="assets/images/payments/googlepay.png" alt="Google Pay payment accepted" class="payment-icon" />
            <img src="assets/images/payments/samsungpay.png" alt="Samsung Pay payment accepted" class="payment-icon" />
            <img src="assets/images/payments/amazonpay.png" alt="Amazon Pay payment accepted" class="payment-icon" />
            <img src="assets/images/payments/klarna.png" alt="Klarna payment accepted" class="payment-icon" />
            <img src="assets/images/payments/affirm.png" alt="Affirm payment accepted" class="payment-icon" />
            <img src="assets/images/payments/afterpay.png" alt="Afterpay payment accepted" class="payment-icon" />
            <img src="assets/images/payments/cashapp.png" alt="Cash App payment accepted" class="payment-icon" />
            <img src="assets/images/payments/paypal.png" alt="PayPal payment accepted" class="payment-icon" />
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>¬© 2025 PictureThisPet. All rights reserved. | v4.0.1 | Last updated: 12:06 AM MDT, May 24, 2025 | <a href="/site-creation" style="color: var(--gold); text-decoration: underline;">AI built my site. Find out How!</a></p>
      </div>
    </footer>
  </div>

  <!-- Context Menu -->
  <div class="context-menu" id="contextMenu">
    <div class="context-menu-item" onclick="addSession()">
      üì∏ Add Session
    </div>
    <div class="context-menu-item" onclick="addPopupEvent()">
      üéâ Add Pop-Up Event
    </div>
    <div class="context-menu-item" onclick="blockDate()">
      üö´ Block Date
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" onclick="editSession()">
      ‚úèÔ∏è Edit Session
    </div>
    <div class="context-menu-item" onclick="editPopupEvent()">
      ‚úèÔ∏è Edit Pop-Up Event
    </div>
    <div class="context-menu-item" onclick="removeSession()">
      üóëÔ∏è Remove Session
    </div>
    <div class="context-menu-item" onclick="removePopupEvent()">
      üóëÔ∏è Remove Pop-Up Event
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" onclick="viewSessionDetails()">
      üëÅÔ∏è View Session Details
    </div>
    <div class="context-menu-item" onclick="viewPopupEventDetails()">
      üëÅÔ∏è View Pop-Up Event Details
    </div>
  </div>

  <!-- Session Modal -->
  <div class="modal-overlay" id="sessionModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="sessionModalTitle">Add New Session</h3>
        <button class="modal-close" onclick="closeSessionModal()">√ó</button>
      </div>
      
      <form id="sessionForm">
        <div class="form-group">
          <label class="form-label">Session ID</label>
          <input type="text" class="form-input" id="sessionId" placeholder="SESSXXX" required readonly>
        </div>
        <div class="form-group">
          <label class="form-label">Client Name</label>
          <input type="text" class="form-input" id="clientName" placeholder="Enter client name" required>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" id="sessionDate" required>
          </div>
          <div class="form-group">
            <label class="form-label">Time</label>
            <input type="time" class="form-input" id="sessionTime" required>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Session Type</label>
          <select class="form-select" id="sessionType" required>
            <option value="">Select session type</option>
            <option value="Full Session">Full Session</option>
            <option value="Mini Session">Mini Session</option>
            <option value="Holiday Session">Holiday Session</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Location</label>
          <select class="form-select" id="sessionLocation" required>
            <option value="">Select location</option>
            <option value="Cheesman Park">Cheesman Park</option>
            <option value="Washington Park">Washington Park</option>
            <option value="Sloan's Lake">Sloan's Lake</option>
            <option value="City Park">City Park</option>
            <option value="Client's Home">Client's Home</option>
          </select>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Client Email</label>
            <input type="email" class="form-input" id="clientEmail" placeholder="client@email.com">
          </div>
          <div class="form-group">
            <label class="form-label">Client Phone</label>
            <input type="tel" class="form-input" id="clientPhone" placeholder="(303) 555-0123">
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Pet Count</label>
          <select class="form-select" id="petCount" required>
            <option value="1">1</option>
            <option value="2">2</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">People Count</label>
          <select class="form-select" id="peopleCount" required>
            <option value="1">1</option>
            <option value="2">2</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea class="form-input" id="sessionNotes" placeholder="Special requests, pet names, etc." rows="3"></textarea>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeSessionModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Session</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Pop-Up Event Modal -->
  <div class="modal-overlay" id="popupEventModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="popupEventModalTitle">Add New Pop-Up Event</h3>
        <button class="modal-close" onclick="closePopupEventModal()">√ó</button>
      </div>
      
      <form id="popupEventForm">
        <div class="form-group">
          <label class="form-label">Event ID</label>
          <input type="text" class="form-input" id="popupEventId" placeholder="POPUPXXX" required readonly>
        </div>
        <div class="form-group">
          <label class="form-label">Event Name</label>
          <input type="text" class="form-input" id="popupEventName" placeholder="e.g., Spring Pet Pop-Up" required>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" id="popupEventDate" required>
          </div>
          <div class="form-group">
            <label class="form-label">Time</label>
            <input type="time" class="form-input" id="popupEventTime" required>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Location</label>
          <select class="form-select" id="popupEventLocation" required>
            <option value="">Select location</option>
            <option value="Cheesman Park">Cheesman Park</option>
            <option value="Washington Park">Washington Park</option>
            <option value="Sloan's Lake">Sloan's Lake</option>
            <option value="City Park">City Park</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Capacity</label>
          <input type="number" class="form-input" id="popupEventCapacity" placeholder="e.g., 50" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-input" id="popupEventDescription" placeholder="Event details..." rows="3" required></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Registration Link (Optional)</label>
          <input type="url" class="form-input" id="popupEventRegistrationLink" placeholder="e.g., https://example.com/register">
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closePopupEventModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Pop-Up Event</button>
        </div>
      </form>
    </div>
  </div>

  <script>
const API_URL = 'https://script.google.com/macros/s/AKfycbwRZDxuvO0HYo1C_NYrjuvwOKiiKl8E79AMJca2Ki4AXtPfM--H4GNBVsEjJwlDLg8d2w/exec';
    let sessions = [];
    let popUpEvents = [];
    let selectedDate = null;
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    let contextMenuSession = null;
    let contextMenuPopupEvent = null;
    let editingSessionRowIndex = null;
    let editingPopupEventRowIndex = null;

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Page loaded, initializing...');
      checkAuthentication();
      fetchSessions();
      fetchPopUpEvents();
      renderCalendar();
    });

    // Check authentication
    function checkAuthentication() {
      const isAuthenticated = localStorage.getItem('adminAuthenticated');
      if (!isAuthenticated) {
        console.log('Not authenticated, redirecting to login...');
        window.location.href = '/admin-login.html';
        return;
      }
      const adminUser = localStorage.getItem('adminUser') || 'Admin';
      document.getElementById('adminUser').textContent = `Welcome, ${adminUser}`;
      console.log('Authenticated as:', adminUser);
    }

    // Logout
    function logout() {
      console.log('Logging out...');
      localStorage.removeItem('adminAuthenticated');
      localStorage.removeItem('adminUser');
      localStorage.removeItem('adminLoginTime');
      window.location.href = '/admin-login.html';
    }

    // Toggle sidebar on mobile
    function toggleSidebar() {
      console.log('Toggling sidebar...');
      const sidebar = document.getElementById('adminSidebar');
      sidebar.classList.toggle('open');
    }

    // Fetch sessions
    async function fetchSessions() {
      try {
        console.log('Fetching sessions from:', `${API_URL}?type=sessions`);
        const response = await fetch(`${API_URL}?type=sessions`);
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        sessions = await response.json();
        if (sessions.error) throw new Error(sessions.error);
        console.log('Sessions fetched:', sessions);
        renderCalendar();
      } catch (error) {
        console.error('Error fetching sessions:', error);
        alert('Failed to load sessions. Please try again.');
        sessions = [];
        renderCalendar();
      }
    }

    // Fetch pop-up events
    async function fetchPopUpEvents() {
      try {
        console.log('Fetching pop-up events from:', `${API_URL}?type=popUpEvents`);
        const response = await fetch(`${API_URL}?type=popUpEvents`);
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        popUpEvents = await response.json();
        if (popUpEvents.error) throw new Error(popUpEvents.error);
        console.log('Pop-up events fetched:', popUpEvents);
        renderCalendar();
      } catch (error) {
        console.error('Error fetching pop-up events:', error);
        alert('Failed to load pop-up events. Please try again.');
        popUpEvents = [];
        renderCalendar();
      }
    }

    // Render calendar
    function renderCalendar() {
      console.log('Rendering calendar for month:', currentMonth, 'year:', currentYear);
      const calendarContainer = document.getElementById('calendarContainer');
      const calendarTitle = document.getElementById('calendarTitle');
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const prevMonthDays = new Date(currentYear, currentMonth, 0).getDate();

      calendarTitle.textContent = new Date(currentYear, currentMonth).toLocaleString('default', { month: 'long', year: 'numeric' });

      let html = `
        <div class="calendar-grid">
          <div class="calendar-day-header">Sun</div>
          <div class="calendar-day-header">Mon</div>
          <div class="calendar-day-header">Tue</div>
          <div class="calendar-day-header">Wed</div>
          <div class="calendar-day-header">Thu</div>
          <div class="calendar-day-header">Fri</div>
          <div class="calendar-day-header">Sat</div>
      `;

      // Add days from previous month
      for (let i = firstDay - 1; i >= 0; i--) {
        html += `<div class="calendar-day other-month">${prevMonthDays - i}</div>`;
      }

      // Add days for current month
      const today = new Date();
      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(currentYear, currentMonth, day);
        const isPast = date < today && date.getMonth() === today.getMonth() && date.getFullYear() === today.getFullYear();
        const session = sessions.find(s => new Date(s['Date']).toDateString() === date.toDateString());
        const popupEvent = popUpEvents.find(e => new Date(e['Date']).toDateString() === date.toDateString());
        let className = isPast ? 'past' : '';
        let events = '';

        if (session) {
          className = 'booked';
          events = `<div class="day-events">${session['Session Type']} with ${session['Client Name']}</div>`;
        } else if (popupEvent) {
          className = 'popup-event';
          events = `<div class="day-events">${popupEvent['Event Name']}</div>`;
        } else {
          className = 'available';
        }

        if (selectedDate && selectedDate.toDateString() === date.toDateString()) {
          className += ' selected';
        }

        html += `
          <div class="calendar-day ${className}" data-date="${date.toISOString()}" onclick="selectDate('${date.toISOString()}')">
            ${day}
            ${events}
          </div>
        `;
      }

      // Add days from next month
      const lastDay = new Date(currentYear, currentMonth, daysInMonth).getDay();
      for (let i = 1; i <= 6 - lastDay; i++) {
        html += `<div class="calendar-day other-month">${i}</div>`;
      }

      html += '</div>';
      calendarContainer.innerHTML = html;

      // Update calendar badge
      const sessionsThisMonth = sessions.filter(s => {
        const sessionDate = new Date(s['Date']);
        return sessionDate.getMonth() === currentMonth && sessionDate.getFullYear() === currentYear;
      });
      const popupEventsThisMonth = popUpEvents.filter(e => {
        const eventDate = new Date(e['Date']);
        return eventDate.getMonth() === currentMonth && eventDate.getFullYear() === currentYear;
      });
      document.getElementById('calendarBadge').textContent = sessionsThisMonth.length + popupEventsThisMonth.length;
    }

    // Navigate to previous month
    function previousMonth() {
      console.log('Navigating to previous month...');
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar();
    }

    // Navigate to next month
    function nextMonth() {
      console.log('Navigating to next month...');
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
    }

    // Select a date on the calendar
    function selectDate(dateStr) {
      console.log('Selecting date:', dateStr);
      selectedDate = new Date(dateStr);
      renderCalendar();

      const dateDetails = document.getElementById('dateDetails');
      const selectedDateInfo = document.getElementById('selectedDateInfo');
      if (!dateDetails || !selectedDateInfo) {
        console.error('Date details elements not found');
        return;
      }

      const session = sessions.find(s => new Date(s['Date']).toDateString() === selectedDate.toDateString());
      const popupEvent = popUpEvents.find(e => new Date(e['Date']).toDateString() === selectedDate.toDateString());
      
      if (session) {
        dateDetails.innerHTML = `
          <p><strong>Session:</strong> ${session['Session Type']} with ${session['Client Name']}</p>
          <p><strong>Time:</strong> ${session['Time']}</p>
          <p><strong>Location:</strong> ${session['Location']}</p>
          <button class="btn btn-small btn-primary" onclick="viewSessionDetails('${session['Session ID']}')">View Details</button>
        `;
      } else if (popupEvent) {
        dateDetails.innerHTML = `
          <p><strong>Pop-Up Event:</strong> ${popupEvent['Event Name']}</p>
          <p><strong>Time:</strong> ${popupEvent['Time']}</p>
          <p><strong>Location:</strong> ${popupEvent['Location']}</p>
          <button class="btn btn-small btn-primary" onclick="viewPopupEventDetails('${popupEvent['Event ID']}')">View Details</button>
        `;
      } else {
        dateDetails.innerHTML = '<p>No session or event scheduled.</p>';
      }
      selectedDateInfo.style.display = 'block';
    }

    // Sync calendar
    function syncCalendar() {
      console.log('Syncing calendar...');
      fetchSessions();
      fetchPopUpEvents();
    }

    // Open full calendar (placeholder)
    function openFullCalendar() {
      console.log('Opening full calendar...');
      alert('Full calendar view coming soon.');
    }

    // Export calendar (placeholder)
    function exportCalendar() {
      console.log('Exporting calendar...');
      alert('Export calendar feature coming soon.');
    }

    // Open session modal
    function openSessionModal(mode, sessionId = null) {
      console.log('Opening session modal in mode:', mode, 'for session:', sessionId);
      const modal = document.getElementById('sessionModal');
      const form = document.getElementById('sessionForm');
      const title = document.getElementById('sessionModalTitle');
      if (!modal || !form || !title) {
        console.error('Session modal elements not found');
        return;
      }

      title.textContent = mode === 'add' ? 'Add New Session' : 'Edit Session';
      editingSessionRowIndex = null;

      if (mode === 'add') {
        form.reset();
        document.getElementById('sessionId').value = `SESS${String(sessions.length + 1).padStart(3, '0')}`;
        if (selectedDate) {
          document.getElementById('sessionDate').value = selectedDate.toISOString().split('T')[0];
        }
      } else {
        const session = sessions.find(s => s['Session ID'] === sessionId);
        if (session) {
          document.getElementById('sessionId').value = session['Session ID'];
          document.getElementById('clientName').value = session['Client Name'];
          document.getElementById('clientEmail').value = session['Client Email'];
          document.getElementById('clientPhone').value = session['Client Phone'];
          document.getElementById('sessionType').value = session['Session Type'];
          document.getElementById('sessionLocation').value = session['Location'];
          document.getElementById('sessionDate').value = new Date(session['Date']).toISOString().split('T')[0];
          document.getElementById('sessionTime').value = session['Time'];
          document.getElementById('sessionNotes').value = session['Notes'];
          document.getElementById('petCount').value = session['Pet Count'];
          document.getElementById('peopleCount').value = session['People Count'];
          editingSessionRowIndex = session.rowIndex;
        }
      }

      modal.style.display = 'flex';
    }

    // Close session modal
    function closeSessionModal() {
      console.log('Closing session modal...');
      const modal = document.getElementById('sessionModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }

    // Open pop-up event modal
    function openPopupEventModal(mode, eventId = null) {
      console.log('Opening pop-up event modal in mode:', mode, 'for event:', eventId);
      const modal = document.getElementById('popupEventModal');
      const form = document.getElementById('popupEventForm');
      const title = document.getElementById('popupEventModalTitle');
      if (!modal || !form || !title) {
        console.error('Pop-up event modal elements not found');
        return;
      }

      title.textContent = mode === 'add' ? 'Add New Pop-Up Event' : 'Edit Pop-Up Event';
      editingPopupEventRowIndex = null;

      if (mode === 'add') {
        form.reset();
        document.getElementById('popupEventId').value = `POPUP${String(popUpEvents.length + 1).padStart(3, '0')}`;
        if (selectedDate) {
          document.getElementById('popupEventDate').value = selectedDate.toISOString().split('T')[0];
        }
      } else {
        const event = popUpEvents.find(e => e['Event ID'] === eventId);
        if (event) {
          document.getElementById('popupEventId').value = event['Event ID'];
          document.getElementById('popupEventName').value = event['Event Name'];
          document.getElementById('popupEventDate').value = new Date(event['Date']).toISOString().split('T')[0];
          document.getElementById('popupEventTime').value = event['Time'];
          document.getElementById('popupEventLocation').value = event['Location'];
          document.getElementById('popupEventCapacity').value = event['Capacity'];
          document.getElementById('popupEventDescription').value = event['Description'];
          document.getElementById('popupEventRegistrationLink').value = event['Registration Link'] || '';
          editingPopupEventRowIndex = event.rowIndex;
        }
      }

      modal.style.display = 'flex';
    }

    // Close pop-up event modal
    function closePopupEventModal() {
      console.log('Closing pop-up event modal...');
      const modal = document.getElementById('popupEventModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }

    // Open block modal (placeholder)
    function openBlockModal() {
      console.log('Opening block modal...');
      alert('Block date feature coming soon.');
    }

    // Context menu functions
    function addSession() {
      console.log('Adding session via context menu...');
      openSessionModal('add');
    }

    function addPopupEvent() {
      console.log('Adding pop-up event via context menu...');
      openPopupEventModal('add');
    }

    function blockDate() {
      console.log('Blocking date via context menu...');
      openBlockModal();
    }

    function editSession(sessionId = contextMenuSession) {
      console.log('Editing session via context menu:', sessionId);
      openSessionModal('edit', sessionId);
    }

    function editPopupEvent(eventId = contextMenuPopupEvent) {
      console.log('Editing pop-up event via context menu:', eventId);
      openPopupEventModal('edit', eventId);
    }

    function removeSession(sessionId = contextMenuSession) {
      console.log('Removing session via context menu:', sessionId);
      if (confirm('Are you sure you want to delete this session?')) {
        const session = sessions.find(s => s['Session ID'] === sessionId);
        if (session) {
          fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              type: 'sessions',
              action: 'delete',
              rowIndex: session.rowIndex,
              session: session
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.status === 'success') {
              sessions = sessions.filter(s => s['Session ID'] !== sessionId);
              renderCalendar();
              closeContextMenu();
            } else {
              alert('Failed to delete session.');
            }
          })
          .catch(error => {
            console.error('Error deleting session:', error);
            alert('Error deleting session.');
          });
        }
      }
    }

    function removePopupEvent(eventId = contextMenuPopupEvent) {
      console.log('Removing pop-up event via context menu:', eventId);
      if (confirm('Are you sure you want to delete this pop-up event?')) {
        const event = popUpEvents.find(e => e['Event ID'] === eventId);
        if (event) {
          fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              type: 'popUpEvents',
              action: 'delete',
              rowIndex: event.rowIndex
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.status === 'success') {
              popUpEvents = popUpEvents.filter(e => e['Event ID'] !== eventId);
              renderCalendar();
              closeContextMenu();
            } else {
              alert('Failed to delete pop-up event.');
            }
          })
          .catch(error => {
            console.error('Error deleting pop-up event:', error);
            alert('Error deleting pop-up event.');
          });
        }
      }
    }

    function viewSessionDetails(sessionId = contextMenuSession) {
      console.log('Viewing session details via context menu:', sessionId);
      const session = sessions.find(s => s['Session ID'] === sessionId);
      if (session) {
        alert(`
          Session Details:
          - Session ID: ${session['Session ID']}
          - Client Name: ${session['Client Name']}
          - Date: ${session['Date']}
          - Time: ${session['Time']}
          - Location: ${session['Location']}
          - Session Type: ${session['Session Type']}
          - Pet Count: ${session['Pet Count']}
          - People Count: ${session['People Count']}
          - Notes: ${session['Notes'] || 'None'}
        `);
        closeContextMenu();
      }
    }

    function viewPopupEventDetails(eventId = contextMenuPopupEvent) {
      console.log('Viewing pop-up event details via context menu:', eventId);
      const event = popUpEvents.find(e => e['Event ID'] === eventId);
      if (event) {
        alert(`
          Pop-Up Event Details:
          - Event ID: ${event['Event ID']}
          - Event Name: ${event['Event Name']}
          - Date: ${event['Date']}
          - Time: ${event['Time']}
          - Location: ${event['Location']}
          - Capacity: ${event['Capacity']}
          - Description: ${event['Description']}
          - Registration Link: ${event['Registration Link'] || 'None'}
        `);
        closeContextMenu();
      }
    }

    function closeContextMenu() {
      console.log('Closing context menu...');
      const contextMenu = document.getElementById('contextMenu');
      if (contextMenu) {
        contextMenu.style.display = 'none';
      }
    }

    // Show context menu on right-click
    document.addEventListener('contextmenu', function(e) {
      const calendarDay = e.target.closest('.calendar-day');
      if (calendarDay && !calendarDay.classList.contains('other-month') && !calendarDay.classList.contains('past')) {
        e.preventDefault();
        const contextMenu = document.getElementById('contextMenu');
        if (!contextMenu) {
          console.error('Context menu element not found');
          return;
        }
        contextMenu.style.display = 'block';
        contextMenu.style.left = `${e.pageX}px`;
        contextMenu.style.top = `${e.pageY}px`;

        const date = new Date(calendarDay.dataset.date);
        const session = sessions.find(s => new Date(s['Date']).toDateString() === date.toDateString());
        const popupEvent = popUpEvents.find(e => new Date(e['Date']).toDateString() === date.toDateString());
        contextMenuSession = session ? session['Session ID'] : null;
        contextMenuPopupEvent = popupEvent ? popupEvent['Event ID'] : null;

        document.querySelectorAll('.context-menu-item').forEach(item => {
          if (item.textContent.includes('Edit Session') || item.textContent.includes('Remove Session') || item.textContent.includes('View Session Details')) {
            item.classList.toggle('disabled', !contextMenuSession);
          }
          if (item.textContent.includes('Edit Pop-Up Event') || item.textContent.includes('Remove Pop-Up Event') || item.textContent.includes('View Pop-Up Event Details')) {
            item.classList.toggle('disabled', !contextMenuPopupEvent);
          }
        });
      } else {
        closeContextMenu();
      }
    });

    // Close context menu on click elsewhere
    document.addEventListener('click', closeContextMenu);

    // Save session
    document.getElementById('sessionForm').addEventListener('submit', function(e) {
      e.preventDefault();
      console.log('Saving session...');
      const session = {
        'Session ID': document.getElementById('sessionId').value,
        'Client Name': document.getElementById('clientName').value,
        'Client Email': document.getElementById('clientEmail').value,
        'Client Phone': document.getElementById('clientPhone').value,
        'Session Type': document.getElementById('sessionType').value,
        'Location': document.getElementById('sessionLocation').value,
        'Date': document.getElementById('sessionDate').value,
        'Time': document.getElementById('sessionTime').value,
        'Notes': document.getElementById('sessionNotes').value,
        'Status': 'booked',
        'Pet Count': document.getElementById('petCount').value,
        'People Count': document.getElementById('peopleCount').value,
        'Payment Status': 'Pending',
        'Price': '',
        'Intake Data': JSON.stringify({}),
        'Pending Actions': JSON.stringify([])
      };

      const action = editingSessionRowIndex ? 'update' : 'add';
      const payload = {
        type: 'sessions',
        action: action,
        session: session,
        rowIndex: editingSessionRowIndex
      };

      fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .then(response => response.json())
      .then(data => {
        if (data.status === 'success') {
          if (action === 'add') {
            sessions.push({ ...session, rowIndex: sessions.length + 2 });
          } else {
            const index = sessions.findIndex(s => s['Session ID'] === session['Session ID']);
            sessions[index] = { ...session, rowIndex: editingSessionRowIndex };
          }
          renderCalendar();
          closeSessionModal();
        } else {
          alert('Failed to save session.');
        }
      })
      .catch(error => {
        console.error('Error saving session:', error);
        alert('Error saving session.');
      });
    });

    // Save pop-up event
    document.getElementById('popupEventForm').addEventListener('submit', function(e) {
      e.preventDefault();
      console.log('Saving pop-up event...');
      const popupEvent = {
        'Event ID': document.getElementById('popupEventId').value,
        'Event Name': document.getElementById('popupEventName').value,
        'Date': document.getElementById('popupEventDate').value,
        'Time': document.getElementById('popupEventTime').value,
        'Location': document.getElementById('popupEventLocation').value,
        'Capacity': document.getElementById('popupEventCapacity').value,
        'Description': document.getElementById('popupEventDescription').value,
        'Registration Link': document.getElementById('popupEventRegistrationLink').value
      };

      const action = editingPopupEventRowIndex ? 'update' : 'add';
      const payload = {
        type: 'popUpEvents',
        action: action,
        event: popupEvent,
        rowIndex: editingPopupEventRowIndex
      };

      fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .then(response => response.json())
      .then(data => {
        if (data.status === 'success') {
          if (action === 'add') {
            popUpEvents.push({ ...popupEvent, rowIndex: popUpEvents.length + 2 });
          } else {
            const index = popUpEvents.findIndex(e => e['Event ID'] === popupEvent['Event ID']);
            popUpEvents[index] = { ...popupEvent, rowIndex: editingPopupEventRowIndex };
          }
          renderCalendar();
          closePopupEventModal();
        } else {
          alert('Failed to save pop-up event.');
        }
      })
      .catch(error => {
        console.error('Error saving pop-up event:', error);
        alert('Error saving pop-up event.');
      });
    });
  </script>
</body>
</html>
