<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Secure Payment | Picture This Pet</title>
  <meta name="description" content="Redirecting to secure payment for your pet photography session.">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --orange: #F47C2C;
      --gold: #FDB75E;
      --dark-brown: #4B2E1E;
      --available-green: #10b981;
      --booked-red: #ef4444;
      --soft-hold-yellow: #f59e0b;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      overflow-x: hidden;
      scrollbar-width: none;
      -ms-overflow-style: none;
      scroll-behavior: smooth;
    }

    html::-webkit-scrollbar {
      width: 0;
      height: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: white;
      background-image: url('assets/images/main_background_allsystem.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      overflow-x: hidden;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    @keyframes moveBackground {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-10px); }
      60% { transform: translateY(-5px); }
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes pawPrint {
      0% { transform: scale(0) rotate(0deg); opacity: 0; }
      50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
      100% { transform: scale(1) rotate(360deg); opacity: 0.8; }
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    header {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.01rem 1.5rem;
      padding-top: calc(0.01rem + env(safe-area-inset-top));
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: cover;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 32px rgba(0,0,0, 0.3);
      border-bottom: 1px solid rgba(255,255,255, 0.1);
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
      height: calc(110px + env(safe-area-inset-top));
    }

    .desktop-logo {
      height: 100px;
    }

    .logo-link {
      display: flex;
      align-items: center;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .logo-link:hover {
      opacity: 0.8;
      transform: scale(1.02);
    }

    .site-nav {
      display: flex;
      align-items: center;
      margin-left: auto;
    }

    .site-nav a:not(.book-btn) {
      margin-left: 1rem;
      text-decoration: none;
      font-weight: 600;
      color: white;
      transition: all 0.3s ease;
      padding: 0.5rem 1rem;
      border-radius: 8px;
    }

    .site-nav a:not(.book-btn):hover {
      background: rgba(255,255,255, 0.1);
      transform: translateY(-1px);
    }

    .book-btn {
      background: linear-gradient(135deg, var(--orange), var(--gold));
      color: white;
      padding: 0.8rem 2rem;
      border: none;
      border-radius: 999px;
      font-weight: 900;
      font-size: 1.2rem;
      text-decoration: none;
      margin-left: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(244,124,44, 0.3);
    }

    .book-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(244,124,44, 0.4);
    }

    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .mobile-menu-btn:hover {
      transform: scale(1.1);
    }

    main {
      margin-top: 110px;
      flex: 1;
      padding: 2rem 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: calc(100vh - 110px);
    }

    .payment-container {
      max-width: 900px;
      width: 100%;
      margin: 0 auto;
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      border-radius: 24px;
      box-shadow: 0 20px 40px rgba(0,0,0, 0.2);
      padding: 2.5rem 2rem;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255, 0.1);
      animation: fadeInUp 1s ease-out;
      text-align: center;
      max-height: calc(100vh - 140px);
      overflow-y: auto;
    }

    .payment-container h1 {
      font-family: 'Playfair Display', serif;
      font-size: 2.5rem;
      font-weight: 700;
      color: white;
      text-shadow: 0 2px 8px rgba(0,0,0, 0.3);
      margin-bottom: 1.5rem;
    }

    .session-summary {
      background: rgba(255,255,255, 0.15);
      border-radius: 20px;
      padding: 2rem;
      margin: 1.5rem 0;
      backdrop-filter: blur(8px);
      border: 2px solid rgba(255,255,255, 0.2);
      box-shadow: 0 8px 32px rgba(0,0,0, 0.1);
    }

    .session-summary h3 {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      color: var(--gold);
      margin-bottom: 1rem;
      text-shadow: 0 2px 4px rgba(0,0,0, 0.2);
    }

    .session-summary p {
      font-size: 1.1rem;
      line-height: 1.6;
      color: rgba(255,255,255, 0.95);
      margin: 0.8rem 0;
      font-weight: 500;
    }

    .session-detail {
      background: rgba(255,255,255, 0.1);
      border-radius: 12px;
      padding: 1rem;
      margin: 0.5rem 0;
      border-left: 4px solid var(--gold);
    }

    .session-includes {
      background: linear-gradient(135deg, rgba(253,183,94, 0.2), rgba(244,124,44, 0.1));
      border-radius: 12px;
      padding: 1.2rem;
      margin: 1rem 0;
      border: 1px solid var(--gold);
    }

    .session-includes h4 {
      color: var(--gold);
      font-size: 1.2rem;
      margin-bottom: 0.8rem;
      font-weight: 600;
    }

    .session-includes ul {
      list-style: none;
      padding: 0;
      text-align: left;
    }

    .session-includes li {
      color: rgba(255,255,255, 0.9);
      padding: 0.3rem 0;
      font-size: 1rem;
      line-height: 1.4;
    }

    .total-price {
      font-size: 2rem;
      font-weight: 700;
      color: var(--gold);
      margin-top: 1.5rem;
      text-shadow: 0 2px 4px rgba(0,0,0, 0.3);
      background: linear-gradient(135deg, var(--gold), var(--orange));
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .security-message {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
      border: 1px solid var(--available-green);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 2rem 0;
      color: white;
    }

    .security-message .icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      animation: pulse 2s infinite;
    }

    .security-message h4 {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--available-green);
    }

    .security-message p {
      font-size: 1rem;
      line-height: 1.5;
      color: rgba(255,255,255, 0.9);
    }

    .loading-animation {
      margin: 3rem 0;
      position: relative;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255,255,255, 0.3);
      border-top: 4px solid var(--gold);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 2rem;
    }

    .paw-prints {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin: 2rem 0;
    }

    .paw {
      font-size: 1.5rem;
      animation: bounce 1.5s infinite;
    }

    .paw:nth-child(1) { animation-delay: 0s; }
    .paw:nth-child(2) { animation-delay: 0.3s; }
    .paw:nth-child(3) { animation-delay: 0.6s; }
    .paw:nth-child(4) { animation-delay: 0.9s; }

    .loading-text {
      font-size: 1.2rem;
      color: rgba(255,255,255, 0.8);
      margin: 1rem 0;
      background: linear-gradient(90deg, rgba(255,255,255,0.6) 0%, rgba(253,183,94,1) 50%, rgba(255,255,255,0.6) 100%);
      background-size: 200% 100%;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 2s ease-in-out infinite;
    }

    .payment-info {
      background: rgba(244,124,44, 0.1);
      border: 1px solid var(--orange);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 2rem 0;
    }

    .payment-info h4 {
      color: var(--orange);
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .payment-info p {
      font-size: 0.95rem;
      line-height: 1.5;
      color: rgba(255,255,255, 0.8);
    }

    .pay-now-button {
      background: linear-gradient(135deg, var(--orange), var(--gold));
      color: white;
      padding: 1.2rem 3rem;
      border: none;
      border-radius: 999px;
      font-weight: 900;
      font-size: 1.3rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(244,124,44, 0.4);
      margin: 2rem 0;
      opacity: 0;
      transform: translateY(20px);
      animation: payButtonAppear 0.8s ease-out 8s forwards;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .pay-now-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(244,124,44, 0.6);
      animation: pulse 1s infinite;
    }

    @keyframes payButtonAppear {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .stripe-iframe-container {
      width: 100%;
      height: 600px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0,0,0, 0.3);
      margin: 2rem 0;
      opacity: 0;
      transform: scale(0.9);
      transition: all 0.5s ease;
      display: none;
    }

    .stripe-iframe-container.show {
      opacity: 1;
      transform: scale(1);
      display: block;
    }

    .stripe-iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 20px;
    }

    .loading-complete {
      display: none;
    }

    .progress-bar {
      width: 100%;
      height: 4px;
      background: rgba(255,255,255, 0.2);
      border-radius: 2px;
      overflow: hidden;
      margin: 2rem 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--orange), var(--gold));
      border-radius: 2px;
      animation: progressFill 3s ease-out forwards;
    }

    @keyframes progressFill {
      0% { width: 0%; }
      100% { width: 100%; }
    }

    .back-button {
      background: rgba(255,255,255, 0.1);
      color: white;
      padding: 0.8rem 1.5rem;
      border: 1px solid rgba(255,255,255, 0.3);
      border-radius: 999px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      margin-top: 2rem;
    }

    .back-button:hover {
      background: rgba(255,255,255, 0.2);
      transform: translateY(-2px);
    }

    footer {
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      border-top: 1px solid rgba(255,255,255, 0.1);
      padding: 2rem 1.5rem;
      color: rgba(255,255,255, 0.5);
      font-size: 0.9rem;
    }

    .footer-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      margin-bottom: 1.5rem;
    }

    .footer-section {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .footer-section h4 {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      font-size: 1.2rem;
      color: white;
      margin-bottom: 1rem;
    }

    .footer-section a {
      color: rgba(255,255,255, 0.7);
      text-decoration: none;
      display: block;
      margin-bottom: 0.5rem;
      transition: color 0.3s ease;
    }

    .footer-section a:hover {
      color: var(--gold);
    }

    .payment-methods {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .payment-icon {
      width: 40px;
      height: 25px;
      object-fit: contain;
      opacity: 0.7;
      transition: opacity 0.3s ease;
    }

    .payment-icon:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    .footer-bottom {
      text-align: center;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255,255,255, 0.1);
    }

    .footer-bottom .site-creation-link {
      white-space: nowrap;
    }

    @media (max-width: 768px) {
      header {
        height: 80px;
        padding: 0.5rem 1rem;
        padding-top: calc(0.5rem + env(safe-area-inset-top));
        height: calc(80px + env(safe-area-inset-top));
      }

      .desktop-logo {
        height: 48px;
      }

      .site-nav {
        display: none;
        flex-direction: column;
        background-image: url('assets/images/ani_bkgd_cool.png');
        background-size: 100% 100%;
        background-position: center;
        position: absolute;
        top: calc(80px + env(safe-area-inset-top));
        right: 0;
        width: 100%;
        text-align: right;
        padding: 1rem;
        z-index: 999;
        border-top: 1px solid rgba(255,255,255, 0.1);
        backdrop-filter: blur(12px);
      }

      .site-nav.active {
        display: flex;
      }

      .site-nav.active a {
        margin: 0.5rem 0;
        font-size: 1.2rem;
        padding: 0.5rem 1rem;
      }

      .site-nav.active a[href="/"] { order: 1; }
      .site-nav.active a[href="/availability.html"] { order: 2; }
      .site-nav.active a[href="/locations.html"] { order: 3; }
      .site-nav.active a[href="/pricing"] { order: 4; }
      .site-nav.active a[href="/contact"] { order: 5; }
      .site-nav.active .book-btn { order: 6; }

      .book-btn {
        padding: 0.6rem 1.5rem;
        font-size: 1rem;
        margin-left: 0;
      }

      .mobile-menu-btn {
        display: block;
      }

      main {
        margin-top: calc(80px + env(safe-area-inset-top));
        padding: 1rem 0.5rem;
        min-height: calc(100vh - 80px - env(safe-area-inset-top));
      }

      .payment-container {
        padding: 1.5rem 1rem;
        max-height: calc(100vh - 100px - env(safe-area-inset-top));
        overflow-y: auto;
      }

      .payment-container h1 {
        font-size: 2rem;
        margin-bottom: 1rem;
      }

      .session-summary {
        padding: 1.5rem;
        margin: 1rem 0;
      }

      .session-summary h3 {
        font-size: 1.4rem;
      }

      .session-detail {
        padding: 0.8rem;
        margin: 0.4rem 0;
      }

      .session-includes {
        padding: 1rem;
        margin: 0.8rem 0;
      }

      .session-includes h4 {
        font-size: 1rem;
        margin-bottom: 0.6rem;
      }

      .session-includes li {
        font-size: 0.9rem;
        padding: 0.2rem 0;
      }

      .total-price {
        font-size: 1.6rem;
        margin-top: 1rem;
      }

      .security-message, .payment-info {
        padding: 1rem;
        margin: 1rem 0;
      }

      .loading-animation {
        margin: 1.5rem 0;
      }

      .pay-now-button {
        padding: 1rem 2rem;
        font-size: 1.1rem;
        margin: 1.5rem 0;
      }

      .stripe-iframe-container {
        height: 500px;
        margin: 1rem 0;
        border-radius: 15px;
      }

      .paw-prints {
        gap: 0.5rem;
      }

      .paw {
        font-size: 1.2rem;
      }

      .footer-container {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .footer-section {
        align-items: center;
        text-align: center;
      }
    }

    @media (max-width: 480px) {
      .payment-container {
        padding: 1.5rem 1rem;
      }

      .payment-container h1 {
        font-size: 1.8rem;
      }

      .session-summary {
        padding: 1rem;
      }

      .session-summary h3 {
        font-size: 1.2rem;
      }

      .session-summary p {
        font-size: 0.95rem;
      }

      .total-price {
        font-size: 1.3rem;
      }

      .security-message, .payment-info {
        padding: 1rem;
      }

      .loading-text {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <a href="/" class="logo-link" aria-label="PictureThisPet Home">
      <img src="assets/images/headerlogowarm.png" alt="PictureThisPet Logo" class="desktop-logo" />
    </a>
    <nav class="site-nav">
      <a href="/" aria-label="Home page">Home</a>
      <a href="/availability.html" aria-label="Availability page">Availability</a>
      <a href="/locations.html" aria-label="Locations page">Locations</a>
      <a href="/pricing" aria-label="Pricing page">Pricing</a>
      <a href="/contact" aria-label="Contact page">Contact</a>
      <a href="/session-builder.html" class="book-btn" aria-label="Book a session">Book Now</a>
    </nav>
    <button class="mobile-menu-btn" aria-label="Toggle mobile menu" onclick="toggleMenu()">‚ò∞</button>
  </header>

  <main>
    <div class="payment-container">
      <h1>Preparing Your Session üêæ</h1>
      
      <div class="session-summary" id="sessionSummary">
        <h3>üì∏ Your Pawsome Session Details</h3>
        <div class="session-detail">
          <p id="sessionType">üéØ Full Session at City Park</p>
        </div>
        <div class="session-detail">
          <p id="sessionPets">üêæ 2 adorable pets</p>
        </div>
        <div class="session-detail">
          <p id="sessionPeople">üë• 2 people</p>
        </div>
        
        <div class="session-includes">
          <h4>‚ú® What's Included in Your Session:</h4>
          <ul id="sessionIncludesList">
            <li>‚è∞ Up to 90 minutes of professional photography</li>
            <li>üì∑ 10 beautifully edited high-resolution photos</li>
            <li>üé® Professional editing and color correction</li>
            <li>üì± Digital delivery via online gallery</li>
            <li>üåü Multiple poses and creative shots</li>
            <li>üìû Pre-session consultation call</li>
            <li>üéÅ Surprise bonus candid shots</li>
          </ul>
        </div>
        
        <div class="total-price" id="totalPrice">üí∞ Total: $160</div>
      </div>

      <div class="security-message">
        <div class="icon">üîí‚ú®</div>
        <h4>üõ°Ô∏è Secure Payment Process</h4>
        <p>üéØ For the best experience, we process payment before scheduling your session date. This ensures your spot is reserved and allows us to coordinate the perfect time for your magical photo session! üìÖ‚ú®</p>
      </div>

      <div class="loading-animation">
        <div class="loading-spinner"></div>
        <div class="paw-prints">
          <span class="paw">üêæ</span>
          <span class="paw">üêæ</span>
          <span class="paw">üêæ</span>
          <span class="paw">üêæ</span>
        </div>
        <div class="loading-text" id="loadingText">Connecting to secure payment...</div>
        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
      </div>

      <div class="payment-info">
        <h4>üöÄ What happens next?</h4>
        <p>üîê Your secure payment portal is ready! After payment, we'll contact you within 24 hours to schedule your perfect session date and time! üìûüíï Get ready for some amazing memories! üéâüì∏</p>
      </div>

      <button class="pay-now-button" id="payNowButton" onclick="showStripeIframe()">
        üí≥ Complete Payment Securely
      </button>

      <div class="stripe-iframe-container" id="stripeContainer">
        <iframe class="stripe-iframe" id="stripeIframe" src="" title="Secure Payment"></iframe>
      </div>

      <a href="/session-builder.html" class="back-button">‚Üê Back to Session Builder</a>
    </div>
  </main>

  <footer>
    <div class="footer-container">
      <div class="footer-section">
        <h4>Contact Us</h4>
        <a href="mailto:info@picturethispet.co" aria-label="Email us at info@picturethispet.co">Email Us</a>
        <a href="https://picturethispet.co" aria-label="Visit our website picturethispet.co">picturethispet.co</a>
      </div>
      <div class="footer-section socials">
        <h4>Connect</h4>
        <a href="https://instagram.com/picturethispet" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Instagram">Instagram</a>
        <a href="/subscribe" aria-label="Subscribe to our newsletter">Subscribe</a>
      </div>
      <div class="footer-section">
        <h4>We Accept</h4>
        <div class="payment-methods">
          <img src="assets/images/payments/visa.png" alt="Visa payment accepted" class="payment-icon" />
          <img src="assets/images/payments/mastercard.png" alt="MasterCard payment accepted" class="payment-icon" />
          <img src="assets/images/payments/amex.png" alt="American Express payment accepted" class="payment-icon" />
          <img src="assets/images/payments/discover.png" alt="Discover payment accepted" class="payment-icon" />
          <img src="assets/images/payments/applepay.png" alt="Apple Pay payment accepted" class="payment-icon" />
          <img src="assets/images/payments/googlepay.png" alt="Google Pay payment accepted" class="payment-icon" />
          <img src="assets/images/payments/samsungpay.png" alt="Samsung Pay payment accepted" class="payment-icon" />
          <img src="assets/images/payments/paypal.png" alt="PayPal payment accepted" class="payment-icon" />
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>¬© 2025 PictureThisPet. All rights reserved. | v1.0.16 | Last updated: 09:18 PM MST, May 26, 2025 | <a href="/site-creation" class="site-creation-link" style="color: var(--gold); text-decoration: underline;" aria-label="Learn how AI built this site">AI built my site. Find out How!</a></p>
    </div>
  </footer>

  <script>
    // Function to get URL parameters
    function getUrlParameter(name) {
      name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      const results = regex.exec(location.search);
      return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    // Function to determine the correct Stripe URL based on session data
    function getStripeUrl(sessionType, location, pets, people) {
      const sessionKey = `${sessionType.toLowerCase()}_${location.toLowerCase().replace(' ', '')}_${pets}pets_${people}people`;
      
      // Stripe URL mapping - you'll provide these URLs
      const stripeUrls = {
        'mini_cheesmanpark_1pets_1people': 'YOUR_STRIPE_URL_HERE',
        'mini_cheesmanpark_1pets_2people': 'YOUR_STRIPE_URL_HERE',
        'mini_cheesmanpark_2pets_1people': 'YOUR_STRIPE_URL_HERE',
        'mini_cheesmanpark_2pets_2people': 'YOUR_STRIPE_URL_HERE',
        'mini_citypark_1pets_1people': 'YOUR_STRIPE_URL_HERE',
        'mini_citypark_1pets_2people': 'YOUR_STRIPE_URL_HERE',
        'mini_citypark_2pets_1people': 'YOUR_STRIPE_URL_HERE',
        'mini_citypark_2pets_2people': 'YOUR_STRIPE_URL_HERE',
        'full_cheesmanpark_1pets_1people': 'YOUR_STRIPE_URL_HERE',
        'full_cheesmanpark_1pets_2people': 'YOUR_STRIPE_URL_HERE',
        'full_cheesmanpark_2pets_1people': 'YOUR_STRIPE_URL_HERE',
        'full_cheesmanpark_2pets_2people': 'YOUR_STRIPE_URL_HERE',
        'full_citypark_1pets_1people': 'YOUR_STRIPE_URL_HERE',
        'full_citypark_1pets_2people': 'YOUR_STRIPE_URL_HERE',
        'full_citypark_2pets_1people': 'YOUR_STRIPE_URL_HERE',
        'full_citypark_2pets_2people': 'YOUR_STRIPE_URL_HERE'
      };
      
      return stripeUrls[sessionKey] || 'YOUR_DEFAULT_STRIPE_URL_HERE';
    }

    // Loading messages that cycle through
    const loadingMessages = [
      "üîê Connecting to secure payment...",
      "üì∏ Preparing your session details...",
      "üêæ Almost ready for your pawsome session!",
      "‚ú® Securing your payment portal...",
      "üéâ Getting everything ready...",
      "üí≥ Payment portal is ready!",
      "üöÄ Click the button when ready!"
    ];

    let messageIndex = 0;
    let redirectTimer;
    let currentStripeUrl = '';

    // Function to show the Stripe iframe
    function showStripeIframe() {
      const payButton = document.getElementById('payNowButton');
      const stripeContainer = document.getElementById('stripeContainer');
      const stripeIframe = document.getElementById('stripeIframe');
      const loadingAnimation = document.querySelector('.loading-animation');

      // Hide the pay button and loading animation
      payButton.style.display = 'none';
      loadingAnimation.classList.add('loading-complete');

      // Set the iframe source to the correct Stripe URL
      stripeIframe.src = currentStripeUrl;

      // Show the iframe with animation
      setTimeout(() => {
        stripeContainer.classList.add('show');
      }, 100);
    }

    // Function to update loading text
    function updateLoadingText() {
      const loadingTextElement = document.getElementById('loadingText');
      loadingTextElement.textContent = loadingMessages[messageIndex];
      messageIndex = (messageIndex + 1) % loadingMessages.length;
    }

    // Function to populate session details from URL or localStorage
    function populateSessionDetails() {
      // Try to get session data from localStorage first (from session builder)
      let sessionData = null;
      try {
        const storedData = localStorage.getItem('sessionData');
        if (storedData) {
          sessionData = JSON.parse(storedData);
        }
      } catch (e) {
        console.warn('No session data in localStorage');
      }

      // If no localStorage data, try URL parameters
      if (!sessionData) {
        const sessionIdentifier = getUrlParameter('session_identifier');
        if (sessionIdentifier) {
          // Parse session identifier from URL
          console.log('Session from URL:', sessionIdentifier);
          // You can add logic here to parse the URL if needed
        }
      }

      // Update the display with session data
      if (sessionData) {
        const sessionTypeElement = document.getElementById('sessionType');
        const sessionPetsElement = document.getElementById('sessionPets');
        const sessionPeopleElement = document.getElementById('sessionPeople');
        const sessionIncludesElement = document.getElementById('sessionIncludesList');
        const totalPriceElement = document.getElementById('totalPrice');

        // Update session details
        sessionTypeElement.textContent = `üéØ ${sessionData.sessionType} Session at ${sessionData.location}`;
        
        let petText = sessionData.pet1Name;
        if (sessionData.pet2Name) {
          petText += ` & ${sessionData.pet2Name}`;
        }
        petText += ` (${sessionData.numberOfPets} pet${sessionData.numberOfPets === '2' ? 's' : ''})`;
        sessionPetsElement.textContent = `üêæ ${petText}`;
        
        sessionPeopleElement.textContent = `üë• ${sessionData.numberOfPeople} person${sessionData.numberOfPeople === '2' ? 's' : ''}`;
        
        // Update session includes based on type
        const isFull = sessionData.sessionType === "Full";
        const includesHTML = isFull ? `
          <li>‚è∞ Up to 90 minutes of professional photography</li>
          <li>üì∑ 10 beautifully edited high-resolution photos</li>
          <li>üé® Professional editing and color correction</li>
          <li>üì± Digital delivery via online gallery</li>
          <li>üåü Multiple poses and creative shots</li>
          <li>üìû Pre-session consultation call</li>
          <li>üéÅ Surprise bonus candid shots</li>
          <li>‚ú® Advanced retouching included</li>
        ` : `
          <li>‚è∞ Up to 60 minutes of professional photography</li>
          <li>üì∑ 5 beautifully edited high-resolution photos</li>
          <li>üé® Professional editing and color correction</li>
          <li>üì± Digital delivery via online gallery</li>
          <li>üåü Multiple poses and creative shots</li>
          <li>üéÅ Surprise bonus candid shots</li>
        `;
        sessionIncludesElement.innerHTML = includesHTML;
        
        totalPriceElement.textContent = `üí∞ Total: ${sessionData.totalPrice}`;

        // Set up redirect to correct Stripe URL
        const stripeUrl = getStripeUrl(
          sessionData.sessionType,
          sessionData.location,
          sessionData.numberOfPets,
          sessionData.numberOfPeople
        );

        console.log('Redirecting to Stripe URL:', stripeUrl);
        
        // Redirect after 5 seconds (increased for better UX)
        redirectTimer = setTimeout(() => {
          if (stripeUrl && stripeUrl !== 'YOUR_STRIPE_URL_HERE' && stripeUrl !== 'YOUR_DEFAULT_STRIPE_URL_HERE') {
            window.location.href = stripeUrl;
          } else {
            // Fallback - show message that Stripe URLs need to be configured
            alert('üöÄ Payment system is being configured. Please contact us directly to complete your booking! üìû');
            window.location.href = '/contact';
          }
        }, 5000);
      }
    }

    // Function to handle mobile menu toggle
    function toggleMenu() {
      const nav = document.querySelector('.site-nav');
      nav.classList.toggle('active');
    }

    // Make showStripeIframe globally available
    window.showStripeIframe = showStripeIframe;

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('‚úÖ Payment loading page loaded');
      
      // Populate session details
      populateSessionDetails();
      
      // Start cycling through loading messages
      const messageInterval = setInterval(updateLoadingText, 1000);
      
      // Clear intervals when leaving page
      window.addEventListener('beforeunload', () => {
        clearInterval(messageInterval);
        if (redirectTimer) clearTimeout(redirectTimer);
      });
    });

    // Handle back navigation
    window.addEventListener('popstate', () => {
      if (redirectTimer) clearTimeout(redirectTimer);
    });
  </script>
</body>
</html>
