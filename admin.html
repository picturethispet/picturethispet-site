<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard | Picture This Pet</title>
  <meta name="description" content="Complete admin dashboard for managing sessions, clients, and galleries.">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet" />

  <style>
    :root {
      --orange: #F47C2C;
      --gold: #FDB75E;
      --dark-brown: #4B2E1E;
      --available-green: #10b981;
      --booked-red: #ef4444;
      --soft-hold-yellow: #f59e0b;
      --admin-purple: #8b5cf6;
      --admin-blue: #3b82f6;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body {
      overflow-x: hidden;
      scrollbar-width: thin;
      scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
    }
    
    html::-webkit-scrollbar {
      width: 8px;
    }
    
    html::-webkit-scrollbar-track {
      background: transparent;
    }
    
    html::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 4px;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: white;
      background: none;
    }

    @keyframes moveBackground {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* === HEADER === */
    header {
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.01rem 1.5rem;
      backdrop-filter: blur(8px);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
      height: 110px;
    }

    .logo-link {
      display: flex;
      align-items: center;
      transition: opacity 0.3s ease;
      text-decoration: none;
    }

    .logo-link:hover {
      opacity: 0.8;
    }
    
    .desktop-logo {
      height: 100px;
    }
    
    .admin-nav {
      display: flex;
      align-items: center;
      margin-left: auto;
      gap: 1rem;
    }

    .admin-info {
      background: rgba(255, 255, 255, 0.1);
      padding: 0.8rem 1.5rem;
      border-radius: 25px;
      font-size: 0.9rem;
      font-weight: 600;
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .logout-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-1px);
    }
    
    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 2rem;
      cursor: pointer;
    }

    /* === MAIN CONTENT === */
    main {
      margin-top: 110px;
      min-height: calc(100vh - 110px);
      background-image: url("assets/images/main_background_allsystem.png");
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      padding: 2rem 1rem;
      position: relative;
    }

    /* === DASHBOARD LAYOUT === */
    .dashboard-container {
      max-width: 1600px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 2rem;
      align-items: start;
    }

    /* === CALENDAR SECTION === */
    .calendar-section {
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      border-radius: 24px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      padding: 3rem;
      color: white;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .calendar-title {
      font-size: 2.2rem;
      font-weight: 700;
      color: white;
    }

    .calendar-nav {
      display: flex;
      gap: 1rem;
    }

    .nav-button {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.2rem;
    }

    .nav-button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.05);
    }

    /* === CALENDAR TOOLS === */
    .calendar-tools {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .tool-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
      padding: 0.7rem 1.2rem;
      border-radius: 12px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .tool-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-1px);
    }

    .tool-btn.primary {
      background: linear-gradient(135deg, var(--orange), var(--gold));
      border-color: var(--gold);
    }

    .tool-btn.secondary {
      background: linear-gradient(135deg, var(--admin-purple), var(--admin-blue));
      border-color: var(--admin-blue);
    }

    .tool-btn.warning {
      background: linear-gradient(135deg, var(--soft-hold-yellow), #f59e0b);
      border-color: #f59e0b;
    }

    /* === CALENDAR GRID === */
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 3rem;
    }

    .calendar-day-header {
      background: rgba(255, 255, 255, 0.15);
      padding: 1.2rem 0.5rem;
      text-align: center;
      font-weight: 600;
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.9);
    }

    .calendar-day {
      background: rgba(255, 255, 255, 0.05);
      padding: 1.2rem 0.5rem;
      text-align: center;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      font-size: 1.1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .calendar-day:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.05);
    }

    .calendar-day.other-month {
      color: rgba(255, 255, 255, 0.3);
      cursor: default;
    }

    .calendar-day.past {
      color: rgba(255, 255, 255, 0.3);
      background: rgba(0, 0, 0, 0.1);
      cursor: default;
    }

    .calendar-day.available {
      background: rgba(16, 185, 129, 0.2);
      border: 2px solid rgba(16, 185, 129, 0.5);
      color: white;
    }

    .calendar-day.available::after {
      content: "‚úì";
      position: absolute;
      top: 4px;
      right: 6px;
      font-size: 0.8rem;
      color: var(--available-green);
      font-weight: bold;
    }

    .calendar-day.booked {
      background: rgba(239, 68, 68, 0.2);
      border: 2px solid rgba(239, 68, 68, 0.5);
      color: rgba(255, 255, 255, 0.9);
    }

    .calendar-day.booked::after {
      content: "üì∏";
      position: absolute;
      top: 4px;
      right: 6px;
      font-size: 0.8rem;
    }

    .calendar-day.soft-hold {
      background: rgba(245, 158, 11, 0.2);
      border: 2px solid rgba(245, 158, 11, 0.5);
      color: rgba(255, 255, 255, 0.9);
    }

    .calendar-day.soft-hold::after {
      content: "?";
      position: absolute;
      top: 4px;
      right: 6px;
      font-size: 0.8rem;
      color: var(--soft-hold-yellow);
      font-weight: bold;
    }

    .calendar-day.blocked {
      background: rgba(75, 85, 99, 0.3);
      border: 2px solid rgba(75, 85, 99, 0.5);
      color: rgba(255, 255, 255, 0.6);
    }

    .calendar-day.blocked::after {
      content: "üö´";
      position: absolute;
      top: 4px;
      right: 6px;
      font-size: 0.8rem;
    }

    .calendar-day.selected {
      background: linear-gradient(135deg, var(--admin-purple), #ec4899);
      border: 2px solid #ec4899;
      color: white;
      transform: scale(1.05);
    }

    /* === CONTEXT MENU === */
    .context-menu {
      position: absolute;
      background: rgba(20, 20, 20, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 0.5rem 0;
      min-width: 180px;
      z-index: 1001;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      display: none;
    }

    .context-menu-item {
      padding: 0.8rem 1rem;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
    }

    .context-menu-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .context-menu-item.disabled {
      color: rgba(255, 255, 255, 0.4);
      cursor: not-allowed;
    }

    .context-menu-divider {
      height: 1px;
      background: rgba(255, 255, 255, 0.1);
      margin: 0.5rem 0;
    }

    /* === MODAL STYLES === */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
    }

    .modal {
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      border-radius: 24px;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
      animation: fadeInUp 0.3s ease;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .modal-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      font-weight: 700;
      color: white;
    }

    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.3s ease;
    }

    .modal-close:hover {
      opacity: 1;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      color: white;
      font-weight: 600;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 0.8rem 1rem;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--admin-purple);
      background: rgba(255, 255, 255, 0.15);
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .modal-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 2rem;
    }

    .btn {
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--orange), var(--gold));
      color: white;
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .btn:hover {
      transform: translateY(-1px);
    }

    /* === LEGEND === */
    .calendar-legend {
      display: flex;
      gap: 2rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-size: 1rem;
      font-weight: 500;
    }

    .legend-dot {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid transparent;
    }

    .legend-dot.available {
      background: rgba(16, 185, 129, 0.7);
      border-color: rgba(16, 185, 129, 0.5);
    }

    .legend-dot.booked {
      background: rgba(239, 68, 68, 0.7);
      border-color: rgba(239, 68, 68, 0.5);
    }

    .legend-dot.soft-hold {
      background: rgba(245, 158, 11, 0.7);
      border-color: rgba(245, 158, 11, 0.5);
    }

    .legend-dot.blocked {
      background: rgba(75, 85, 99, 0.7);
      border-color: rgba(75, 85, 99, 0.5);
    }

    .legend-dot.selected {
      background: linear-gradient(135deg, var(--admin-purple), #ec4899);
      border-color: #ec4899;
    }

    /* === ADMIN PANEL === */
    .admin-panel {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    /* === CLIENT PROFILE PANEL === */
    .client-panel {
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      border-radius: 24px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      padding: 2rem;
      color: white;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: none;
    }

    .client-panel.active {
      display: block;
    }

    .panel-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .panel-title {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: white;
    }

    .panel-subtitle {
      color: rgba(255, 255, 255, 0.8);
      font-size: 1rem;
    }

    .client-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .section-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: white;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .client-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .info-item {
      margin-bottom: 0.8rem;
    }

    .info-label {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 0.2rem;
    }

    .info-value {
      font-size: 1rem;
      font-weight: 500;
      color: white;
    }

    .pet-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .pet-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--gold);
      margin-bottom: 0.5rem;
    }

    .pet-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
      font-size: 0.9rem;
    }

    /* === PASSWORD MANAGEMENT === */
    .password-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .password-display {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .password-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .password-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn-small {
      padding: 0.4rem 0.8rem;
      font-size: 0.8rem;
      border-radius: 6px;
    }

    /* === GALLERY MANAGEMENT === */
    .gallery-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .gallery-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .action-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
      padding: 0.8rem 1rem;
      border-radius: 12px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      text-align: center;
    }

    .action-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-2px);
    }

    .action-btn.primary {
      background: linear-gradient(135deg, var(--orange), var(--gold));
      border-color: var(--gold);
    }

    .action-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(244, 124, 44, 0.3);
    }

    .action-btn.gallery {
      background: linear-gradient(135deg, var(--admin-purple), var(--admin-blue));
      border-color: var(--admin-blue);
    }

    .action-btn.gallery:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
    }

    .gallery-status {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }

    .gallery-status.no-gallery {
      color: rgba(255, 255, 255, 0.7);
      font-style: italic;
    }

    .gallery-status.has-gallery {
      background: rgba(16, 185, 129, 0.2);
      border: 1px solid rgba(16, 185, 129, 0.5);
      color: white;
    }

    /* === DEFAULT STATE === */
    .default-panel {
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      border-radius: 24px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      padding: 3rem;
      color: white;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
    }

    .default-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.7;
    }

    .default-title {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: white;
    }

    .default-subtitle {
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.6;
      margin-bottom: 2rem;
    }

    .quick-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    /* === LOADING INDICATOR === */
    .loading-indicator {
      text-align: center;
      padding: 2rem;
      color: rgba(255, 255, 255, 0.8);
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      margin: 2rem 0;
    }

    .loading-indicator h3 {
      margin-bottom: 1rem;
      color: var(--admin-purple);
    }

    /* === RESPONSIVE === */
    @media (max-width: 1200px) {
      .dashboard-container {
        grid-template-columns: 1fr;
        gap: 2rem;
      }
    }

    @media (max-width: 768px) {
      header {
        height: 80px;
        padding: 0.5rem 1rem;
      }
      
      .desktop-logo {
        height: 48px;
      }
      
      .admin-nav {
        display: none;
        flex-direction: column;
        background-image: url('assets/images/ani_bkgd_cool.png');
        background-size: 100% 100%;
        background-position: center;
        position: absolute;
        top: 80px;
        right: 0;
        width: 100%;
        text-align: right;
        padding: 1rem;
        z-index: 999;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(12px);
        gap: 1rem;
      }
      
      .admin-nav.active {
        display: flex;
      }
      
      .mobile-menu-btn {
        display: block;
      }

      main {
        margin-top: 80px;
        padding: 1rem;
      }

      .calendar-section,
      .client-panel,
      .default-panel {
        padding: 2rem;
      }

      .calendar-title,
      .panel-title,
      .default-title {
        font-size: 1.8rem;
      }

      .calendar-day {
        min-height: 45px;
        font-size: 0.95rem;
        padding: 1rem 0.3rem;
      }

      .calendar-day-header {
        padding: 1rem 0.3rem;
        font-size: 0.9rem;
      }

      .client-info,
      .pet-details {
        grid-template-columns: 1fr;
      }

      .gallery-actions,
      .quick-actions {
        grid-template-columns: 1fr;
      }

      .nav-button {
        width: 40px;
        height: 40px;
        font-size: 1rem;
      }

      .calendar-tools {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .modal {
        width: 95%;
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <a href="/" class="logo-link">
      <img src="assets/images/headerlogowarm.png" alt="PictureThisPet Logo" class="desktop-logo" />
    </a>
    <nav class="admin-nav">
      <div class="admin-info" id="adminInfo">Admin Dashboard</div>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </nav>
    <button class="mobile-menu-btn" onclick="toggleMenu()">‚ò∞</button>
  </header>

  <main>
    <div class="dashboard-container">
      <!-- Calendar Section -->
      <div class="calendar-section">
        <div class="calendar-header">
          <h2 class="calendar-title" id="calendarTitle">Loading...</h2>
          <div class="calendar-nav">
            <button class="nav-button" onclick="previousMonth()">‚Äπ</button>
            <button class="nav-button" onclick="nextMonth()">‚Ä∫</button>
          </div>
        </div>

        <!-- Calendar Tools -->
        <div class="calendar-tools">
          <button class="tool-btn primary" onclick="showAddSessionModal()">
            ‚ûï Add Session
          </button>
          <button class="tool-btn warning" onclick="enterBlockMode()">
            üö´ Block Time
          </button>
          <button class="tool-btn secondary" onclick="enterEditMode()">
            ‚úèÔ∏è Edit Mode
          </button>
          <button class="tool-btn" onclick="refreshCalendar()">
            üîÑ Refresh
          </button>
        </div>

        <div id="calendarContainer">
          <div class="loading-indicator" id="loadingIndicator">
            <h3>üîÑ Loading Calendar...</h3>
            <p>Fetching live data from Google Calendar</p>
          </div>
        </div>

        <div class="calendar-legend">
          <div class="legend-item">
            <div class="legend-dot available"></div>
            <span>Available</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot soft-hold"></div>
            <span>Soft Hold</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot booked"></div>
            <span>Session Booked</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot blocked"></div>
            <span>Blocked</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot selected"></div>
            <span>Selected</span>
          </div>
        </div>
      </div>

      <!-- Admin Panel -->
      <div class="admin-panel">
        <!-- Default State -->
        <div class="default-panel" id="defaultPanel">
          <div class="default-icon">üìÖ</div>
          <h2 class="default-title">Admin Dashboard</h2>
          <p class="default-subtitle">
            Click on any session date in the calendar to view client details, manage bookings, 
            and create photo galleries. Use the tools above to add sessions, block time, or edit existing bookings.
          </p>
          
          <div class="quick-actions">
            <button class="action-btn primary" onclick="window.open('https://calendar.google.com/calendar/u/0/r/week', '_blank')">
              üìÖ Full Google Calendar
            </button>
            <button class="action-btn" onclick="refreshCalendar()">
              üîÑ Refresh Calendar
            </button>
            <button class="action-btn" onclick="window.open('/availability.html', '_blank')">
              üëÅÔ∏è Public View
            </button>
            <button class="action-btn gallery" onclick="window.open('/gallery-login.html', '_blank')">
              üì∏ Test Client Gallery
            </button>
          </div>
        </div>

        <!-- Client Profile Panel -->
        <div class="client-panel" id="clientPanel">
          <div class="panel-header">
            <h2 class="panel-title" id="sessionTitle">Session Details</h2>
            <p class="panel-subtitle" id="sessionDate">Select a session to view details</p>
          </div>

          <!-- Session Actions -->
          <div class="client-section">
            <h3 class="section-title">‚öôÔ∏è Session Actions</h3>
            <div class="gallery-actions">
              <button class="action-btn" onclick="editSession()">
                ‚úèÔ∏è Edit Session
              </button>
              <button class="action-btn warning" onclick="cancelSession()">
                ‚ùå Cancel Session
              </button>
              <button class="action-btn secondary" onclick="rescheduleSession()">
                üìÖ Reschedule
              </button>
              <button class="action-btn" onclick="duplicateSession()">
                üìã Duplicate
              </button>
            </div>
          </div>

          <!-- Client Information -->
          <div class="client-section">
            <h3 class="section-title">üë§ Client Information</h3>
            <div class="client-info" id="clientInfo">
              <!-- Will be populated dynamically -->
            </div>
          </div>

          <!-- Pet Information -->
          <div class="client-section">
            <h3 class="section-title">üêï Pet Information</h3>
            <div id="petInfo">
              <!-- Will be populated dynamically -->
            </div>
          </div>

          <!-- Session Details -->
          <div class="client-section">
            <h3 class="section-title">üìã Session Details</h3>
            <div class="client-info" id="sessionInfo">
              <!-- Will be populated dynamically -->
            </div>
          </div>

          <!-- Password Management -->
          <div class="password-section">
            <h3 class="section-title">üîê Gallery Access Management</h3>
            <div class="password-display" id="passwordDisplay">
              <!-- Will be populated dynamically -->
            </div>
            <div class="gallery-actions">
              <button class="action-btn" onclick="regeneratePassword()">
                üîÑ New Password
              </button>
              <button class="action-btn" onclick="regenerateSessionId()">
                üÜî New Session ID
              </button>
            </div>
          </div>

          <!-- Gallery Management -->
          <div class="client-section">
            <h3 class="section-title">üì∏ Gallery Management</h3>
            <div class="gallery-section">
              <div class="gallery-actions">
                <button class="action-btn gallery" onclick="createGallery()">
                  ‚ûï Create Gallery
                </button>
                <button class="action-btn" onclick="uploadPhotos()">
                  üì∑ Upload Photos
                </button>
                <button class="action-btn" onclick="viewGallery()">
                  üëÅÔ∏è View Gallery
                </button>
                <button class="action-btn primary" onclick="sendCredentials()">
                  üìß Send Access
                </button>
              </div>
              <div class="gallery-status" id="galleryStatus">
                <p>No gallery created yet for this session</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
      <div class="context-menu-item" onclick="addSessionToDate()">
        ‚ûï Add Session
      </div>
      <div class="context-menu-item" onclick="addSoftHoldToDate()">
        ‚è≥ Add Soft Hold
      </div>
      <div class="context-menu-item" onclick="blockDate()">
        üö´ Block This Date
      </div>
      <div class="context-menu-divider"></div>
      <div class="context-menu-item" onclick="editExistingSession()">
        ‚úèÔ∏è Edit Session
      </div>
      <div class="context-menu-item" onclick="removeFromDate()">
        üóëÔ∏è Remove/Cancel
      </div>
    </div>

    <!-- Add Session Modal -->
    <div class="modal-overlay" id="addSessionModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">Add New Session</h2>
          <button class="modal-close" onclick="closeModal('addSessionModal')">√ó</button>
        </div>
        
        <form id="addSessionForm">
          <div class="form-group">
            <label class="form-label">Session Type</label>
            <select class="form-select" id="sessionType" required>
              <option value="">Select Session Type</option>
              <option value="full">Full Session (1.5 hours)</option>
              <option value="mini">Mini Session (45 minutes)</option>
              <option value="headshots">Pet Headshots (30 minutes)</option>
              <option value="event">Special Event</option>
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Date</label>
              <input type="date" class="form-input" id="sessionDate" required />
            </div>
            <div class="form-group">
              <label class="form-label">Time</label>
              <input type="time" class="form-input" id="sessionTime" required />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Client Name</label>
            <input type="text" class="form-input" id="clientName" placeholder="John Smith" required />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" id="clientEmail" placeholder="john@email.com" required />
            </div>
            <div class="form-group">
              <label class="form-label">Phone</label>
              <input type="tel" class="form-input" id="clientPhone" placeholder="(555) 123-4567" required />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Location</label>
            <select class="form-select" id="sessionLocation" required>
              <option value="">Select Location</option>
              <option value="cheesman">Cheesman Park</option>
              <option value="wash">Washington Park</option>
              <option value="city">City Park</option>
              <option value="sloan">Sloan's Lake</option>
              <option value="studio">Studio</option>
              <option value="client-home">Client's Home</option>
              <option value="other">Other Location</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Pet Name(s)</label>
            <input type="text" class="form-input" id="petNames" placeholder="Buddy, Max, Bella" required />
          </div>

          <div class="form-group">
            <label class="form-label">Special Notes</label>
            <textarea class="form-textarea" id="sessionNotes" placeholder="Any special requirements or notes about the session..."></textarea>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="closeModal('addSessionModal')">Cancel</button>
            <button type="submit" class="btn btn-primary">Create Session</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Edit Session Modal -->
    <div class="modal-overlay" id="editSessionModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">Edit Session</h2>
          <button class="modal-close" onclick="closeModal('editSessionModal')">√ó</button>
        </div>
        
        <form id="editSessionForm">
          <!-- Same form fields as add session, but pre-populated -->
          <div class="form-group">
            <label class="form-label">Session Type</label>
            <select class="form-select" id="editSessionType" required>
              <option value="full">Full Session (1.5 hours)</option>
              <option value="mini">Mini Session (45 minutes)</option>
              <option value="headshots">Pet Headshots (30 minutes)</option>
              <option value="event">Special Event</option>
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Date</label>
              <input type="date" class="form-input" id="editSessionDate" required />
            </div>
            <div class="form-group">
              <label class="form-label">Time</label>
              <input type="time" class="form-input" id="editSessionTime" required />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Client Name</label>
            <input type="text" class="form-input" id="editClientName" required />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" id="editClientEmail" required />
            </div>
            <div class="form-group">
              <label class="form-label">Phone</label>
              <input type="tel" class="form-input" id="editClientPhone" required />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Location</label>
            <select class="form-select" id="editSessionLocation" required>
              <option value="cheesman">Cheesman Park</option>
              <option value="wash">Washington Park</option>
              <option value="city">City Park</option>
              <option value="sloan">Sloan's Lake</option>
              <option value="studio">Studio</option>
              <option value="client-home">Client's Home</option>
              <option value="other">Other Location</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Pet Name(s)</label>
            <input type="text" class="form-input" id="editPetNames" required />
          </div>

          <div class="form-group">
            <label class="form-label">Special Notes</label>
            <textarea class="form-textarea" id="editSessionNotes"></textarea>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="closeModal('editSessionModal')">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <script>
    // Global variables
    let currentMonth = new Date();
    let selectedDate = null;
    let selectedDateElement = null;
    let calendarEvents = [];
    let bookedDates = [];
    let softHoldDates = [];
    let blockedDates = [];
    let calendarLoaded = false;
    let currentMode = 'view'; // view, block, edit
    let contextMenuDate = null;

    // Authentication check
    function checkAuthentication() {
      const isAuthenticated = localStorage.getItem('adminAuthenticated');
      const loginTime = localStorage.getItem('adminLoginTime');
      const adminUser = localStorage.getItem('adminUser');
      
      if (!isAuthenticated || !loginTime || !adminUser) {
        window.location.href = '/admin-login.html';
        return false;
      }
      
      // Check if session is still valid (24 hours)
      const loginDate = new Date(loginTime);
      const now = new Date();
      const hoursDiff = (now - loginDate) / (1000 * 60 * 60);
      
      if (hoursDiff >= 24) {
        logout();
        return false;
      }
      
      // Update admin info display
      document.getElementById('adminInfo').textContent = `Welcome, ${adminUser}`;
      return true;
    }

    // Logout function
    function logout() {
      localStorage.removeItem('adminAuthenticated');
      localStorage.removeItem('adminUser');
      localStorage.removeItem('adminLoginTime');
      window.location.href = '/admin-login.html';
    }

    // Mobile menu toggle
    function toggleMenu() {
      const nav = document.querySelector('.admin-nav');
      nav.classList.toggle('active');
    }

    // Sample client data (enhanced with more sessions)
    const sampleClientData = {
      '2024-12-15': {
        sessionData: {
          session: 'Full Session',
          park: 'Cheesman Park',
          selectedDateTime: '2024-12-15T18:00:00',
          petCount: '2',
          peopleCount: '1',
          sessionType: 'full',
          notes: 'Buffy can be shy at first, Max is great with directions'
        },
        intakeData: {
          person1: {
            name: 'Sarah Johnson',
            email: 'sarah.johnson@email.com',
            phone: '303-555-0123',
            zip: '80206'
          },
          pet1: {
            name: 'Buffy',
            age: '3',
            gender: 'Female',
            behavior: 'Friendly and energetic, loves to play fetch',
            offLeash: 'yes',
            favoriteToy: 'Tennis ball'
          },
          pet2: {
            name: 'Max',
            age: '5',
            gender: 'Male', 
            behavior: 'Calm and well-behaved, good with commands',
            offLeash: 'yes',
            favoriteToy: 'Rope toy'
          },
          specialRequests: 'Buffy can be shy at first, Max is great with directions',
          photoStyle: 'both'
        },
        hasGallery: false,
        sessionId: '3123806',
        password: 'buffybarks'
      },
      '2024-12-22': {
        sessionData: {
          session: 'Mini Session',
          park: 'Washington Park',
          selectedDateTime: '2024-12-22T14:00:00',
          petCount: '1',
          peopleCount: '2',
          sessionType: 'mini',
          notes: 'First time photo session'
        },
        intakeData: {
          person1: {
            name: 'Mike Rodriguez',
            email: 'mike.r@email.com',
            phone: '720-555-0198',
            zip: '80224'
          },
          pet1: {
            name: 'Luna',
            age: '2',
            gender: 'Female',
            behavior: 'Very playful, loves treats',
            offLeash: 'no',
            favoriteToy: 'Squeaky toy'
          },
          photoStyle: 'lifestyle'
        },
        hasGallery: true,
        sessionId: '5198224',
        password: 'lunabarks'
      }
    };

    // Calendar data source
    const CALENDAR_FEED_URL = 'https://calendar.google.com/calendar/ical/093785ac4fc4bc53250acaa7df418b5b8716de067a84d27861ecb39c75d91a51%40group.calendar.google.com/public/basic.ics';

    // Parse iCal data
    function parseICalData(icsData) {
      const events = [];
      const lines = icsData.split('\n');
      let currentEvent = {};
      let inEvent = false;

      for (let line of lines) {
        line = line.trim();
        
        if (line === 'BEGIN:VEVENT') {
          inEvent = true;
          currentEvent = {};
        } else if (line === 'END:VEVENT') {
          if (currentEvent.dtstart && currentEvent.summary) {
            events.push(currentEvent);
          }
          inEvent = false;
        } else if (inEvent) {
          if (line.startsWith('DTSTART')) {
            const dateMatch = line.match(/DTSTART[^:]*:(\d{8}T?\d{0,6}Z?)/);
            if (dateMatch) {
              currentEvent.dtstart = parseDateFromICS(dateMatch[1]);
            }
          } else if (line.startsWith('DTEND')) {
            const dateMatch = line.match(/DTEND[^:]*:(\d{8}T?\d{0,6}Z?)/);
            if (dateMatch) {
              currentEvent.dtend = parseDateFromICS(dateMatch[1]);
            }
          } else if (line.startsWith('SUMMARY:')) {
            currentEvent.summary = line.substring(8);
          }
        }
      }
      return events;
    }

    // Parse date from ICS format
    function parseDateFromICS(dateStr) {
      if (dateStr.includes('T')) {
        const year = dateStr.substring(0, 4);
        const month = dateStr.substring(4, 6);
        const day = dateStr.substring(6, 8);
        const hour = dateStr.substring(9, 11) || '00';
        const minute = dateStr.substring(11, 13) || '00';
        return new Date(`${year}-${month}-${day}T${hour}:${minute}:00`);
      } else {
        const year = dateStr.substring(0, 4);
        const month = dateStr.substring(4, 6);
        const day = dateStr.substring(6, 8);
        return new Date(`${year}-${month}-${day}`);
      }
    }

    // Fetch calendar data
    async function fetchCalendarData() {
      try {
        console.log('Fetching admin calendar data...');
        const proxyUrl = 'https://gcal-cors-proxy.vercel.app?url=';
        const response = await fetch(proxyUrl + encodeURIComponent(CALENDAR_FEED_URL));
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const icsData = await response.text();
        console.log('Admin calendar data fetched successfully');
        
        calendarEvents = parseICalData(icsData);
        console.log('Parsed admin events:', calendarEvents);
        
        processCalendarEvents();
        calendarLoaded = true;
        generateCalendar();
        
      } catch (error) {
        console.error('Error fetching admin calendar data:', error);
        console.log('Using fallback data for admin...');
        // Fallback data
        bookedDates = ["2024-12-15", "2024-12-22", "2024-12-29", "2025-01-05"];
        softHoldDates = ["2024-12-18", "2025-01-08"];
        blockedDates = ["2024-12-25", "2025-01-01"];
        calendarLoaded = true;
        generateCalendar();
      }
    }

    // Process calendar events
    function processCalendarEvents() {
      bookedDates = [];
      softHoldDates = [];
      blockedDates = [];
      
      calendarEvents.forEach(event => {
        if (event.dtstart) {
          const eventDate = event.dtstart;
          const dateString = `${eventDate.getFullYear()}-${String(eventDate.getMonth() + 1).padStart(2, '0')}-${String(eventDate.getDate()).padStart(2, '0')}`;
          
          const summary = (event.summary || '').toLowerCase();
          
          if (summary.includes('blocked') || summary.includes('unavailable')) {
            blockedDates.push(dateString);
          } else if (summary.includes('hold') || summary.includes('pending') || summary.includes('maybe')) {
            softHoldDates.push(dateString);
          } else if (summary.includes('booked') || summary.includes('session') || summary.includes('appointment')) {
            bookedDates.push(dateString);
          } else {
            bookedDates.push(dateString);
          }
        }
      });
      
      console.log('Admin processed booked dates:', bookedDates);
      console.log('Admin processed soft hold dates:', softHoldDates);
      console.log('Admin processed blocked dates:', blockedDates);
    }

    // Generate calendar
    function generateCalendar() {
      const container = document.getElementById('calendarContainer');
      const title = document.getElementById('calendarTitle');
      
      if (!container || !title) {
        console.error('Admin calendar elements not found');
        return;
      }
      
      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();
      
      title.textContent = new Intl.DateTimeFormat('en-US', { 
        month: 'long', 
        year: 'numeric' 
      }).format(currentMonth);

      // Clear container and create grid
      container.innerHTML = '';
      const grid = document.createElement('div');
      grid.className = 'calendar-grid';
      grid.id = 'calendarGrid';

      // Add day headers
      const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      dayHeaders.forEach(day => {
        const header = document.createElement('div');
        header.className = 'calendar-day-header';
        header.textContent = day;
        grid.appendChild(header);
      });

      // Calculate first day of month and number of days
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDayOfWeek = firstDay.getDay();

      // Add empty cells for days before month starts
      for (let i = 0; i < startingDayOfWeek; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day other-month';
        grid.appendChild(emptyDay);
      }

      // Add days of the month
      for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        dayElement.textContent = day;
        
        const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayDate = new Date(year, month, day);
        
        // Add click handler for admin functionality
        dayElement.onclick = (e) => selectDate(dateString, dayElement, dayDate, e);
        dayElement.oncontextmenu = (e) => showContextMenu(e, dateString, dayElement);
        
        // Mark past dates
        if (dayDate < new Date()) {
          dayElement.classList.add('past');
        }
        // Mark blocked dates
        else if (blockedDates.includes(dateString)) {
          dayElement.classList.add('blocked');
        }
        // Mark booked dates (sessions)
        else if (bookedDates.includes(dateString)) {
          dayElement.classList.add('booked');
        }
        // Mark soft hold dates
        else if (softHoldDates.includes(dateString)) {
          dayElement.classList.add('soft-hold');
        }
        // Mark available dates
        else if (dayDate.getDay() !== 0) {
          dayElement.classList.add('available');
        }
        
        grid.appendChild(dayElement);
      }
      
      container.appendChild(grid);
      console.log('Admin calendar generated successfully');
    }

    // Select date and show client profile
    function selectDate(dateString, element, dateObj, event) {
      if (event) event.preventDefault();
      
      // Handle different modes
      if (currentMode === 'block') {
        toggleBlockDate(dateString, element);
        return;
      }
      
      if (currentMode === 'edit' && (bookedDates.includes(dateString) || softHoldDates.includes(dateString))) {
        showEditSessionModal(dateString);
        return;
      }
      
      // Remove previous selection
      document.querySelectorAll('.calendar-day.selected').forEach(el => {
        el.classList.remove('selected');
      });
      
      // Add selection to clicked date
      element.classList.add('selected');
      
      selectedDate = dateString;
      selectedDateElement = element;
      
      // Check if this date has a session
      if (bookedDates.includes(dateString)) {
        showClientProfile(dateString);
      } else {
        showDefaultPanel();
      }
      
      console.log('Admin selected date:', dateString);
    }

    // Show context menu
    function showContextMenu(event, dateString, element) {
      event.preventDefault();
      contextMenuDate = dateString;
      
      const contextMenu = document.getElementById('contextMenu');
      const dayDate = new Date(dateString);
      const isPast = dayDate < new Date();
      const isBooked = bookedDates.includes(dateString);
      const isSoftHold = softHoldDates.includes(dateString);
      const isBlocked = blockedDates.includes(dateString);
      
      // Position menu
      contextMenu.style.left = event.pageX + 'px';
      contextMenu.style.top = event.pageY + 'px';
      contextMenu.style.display = 'block';
      
      // Update menu items based on date status
      const menuItems = contextMenu.querySelectorAll('.context-menu-item');
      menuItems.forEach(item => {
        item.classList.remove('disabled');
      });
      
      // Disable items for past dates
      if (isPast) {
        menuItems.forEach(item => {
          if (!item.textContent.includes('View')) {
            item.classList.add('disabled');
          }
        });
      }
      
      // Hide context menu when clicking elsewhere
      setTimeout(() => {
        document.addEventListener('click', hideContextMenu, { once: true });
      }, 100);
    }

    // Hide context menu
    function hideContextMenu() {
      document.getElementById('contextMenu').style.display = 'none';
    }

    // Context menu actions
    function addSessionToDate() {
      hideContextMenu();
      if (contextMenuDate) {
        document.getElementById('sessionDate').value = contextMenuDate;
        showAddSessionModal();
      }
    }

    function addSoftHoldToDate() {
      hideContextMenu();
      if (contextMenuDate) {
        if (!softHoldDates.includes(contextMenuDate)) {
          softHoldDates.push(contextMenuDate);
          generateCalendar();
          // In real app, would sync with Google Calendar
          console.log('Added soft hold to:', contextMenuDate);
        }
      }
    }

    function blockDate() {
      hideContextMenu();
      if (contextMenuDate) {
        if (!blockedDates.includes(contextMenuDate)) {
          blockedDates.push(contextMenuDate);
          generateCalendar();
          // In real app, would sync with Google Calendar
          console.log('Blocked date:', contextMenuDate);
        }
      }
    }

    function editExistingSession() {
      hideContextMenu();
      if (contextMenuDate && (bookedDates.includes(contextMenuDate) || softHoldDates.includes(contextMenuDate))) {
        showEditSessionModal(contextMenuDate);
      }
    }

    function removeFromDate() {
      hideContextMenu();
      if (contextMenuDate) {
        // Remove from all arrays
        const index1 = bookedDates.indexOf(contextMenuDate);
        const index2 = softHoldDates.indexOf(contextMenuDate);
        const index3 = blockedDates.indexOf(contextMenuDate);
        
        if (index1 > -1) bookedDates.splice(index1, 1);
        if (index2 > -1) softHoldDates.splice(index2, 1);
        if (index3 > -1) blockedDates.splice(index3, 1);
        
        generateCalendar();
        showDefaultPanel();
        console.log('Removed from date:', contextMenuDate);
      }
    }

    // Tool functions
    function showAddSessionModal() {
      const modal = document.getElementById('addSessionModal');
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
      
      // Set default date if selected
      if (selectedDate) {
        document.getElementById('sessionDate').value = selectedDate;
      }
    }

    function enterBlockMode() {
      currentMode = currentMode === 'block' ? 'view' : 'block';
      const btn = event.target;
      
      if (currentMode === 'block') {
        btn.textContent = '‚úì Block Mode (Click dates)';
        btn.style.background = 'linear-gradient(135deg, var(--booked-red), #dc2626)';
        alert('üìç Block Mode Active\n\nClick on any available date to block it for sessions. Click the button again to exit block mode.');
      } else {
        btn.textContent = 'üö´ Block Time';
        btn.style.background = 'linear-gradient(135deg, var(--soft-hold-yellow), #f59e0b)';
      }
    }

    function enterEditMode() {
      currentMode = currentMode === 'edit' ? 'view' : 'edit';
      const btn = event.target;
      
      if (currentMode === 'edit') {
        btn.textContent = '‚úì Edit Mode (Click sessions)';
        btn.style.background = 'linear-gradient(135deg, var(--admin-purple), var(--admin-blue))';
        alert('‚úèÔ∏è Edit Mode Active\n\nClick on any booked session to edit its details. Click the button again to exit edit mode.');
      } else {
        btn.textContent = '‚úèÔ∏è Edit Mode';
        btn.style.background = 'linear-gradient(135deg, var(--admin-purple), var(--admin-blue))';
      }
    }

    function toggleBlockDate(dateString, element) {
      if (blockedDates.includes(dateString)) {
        // Unblock date
        const index = blockedDates.indexOf(dateString);
        blockedDates.splice(index, 1);
        console.log('Unblocked date:', dateString);
      } else {
        // Block date (but don't block if already booked)
        if (!bookedDates.includes(dateString)) {
          blockedDates.push(dateString);
          console.log('Blocked date:', dateString);
        }
      }
      generateCalendar();
    }

    // Modal functions
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
      document.body.style.overflow = 'auto';
    }

    // Form submissions
    document.getElementById('addSessionForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = {
        type: document.getElementById('sessionType').value,
        date: document.getElementById('sessionDate').value,
        time: document.getElementById('sessionTime').value,
        clientName: document.getElementById('clientName').value,
        clientEmail: document.getElementById('clientEmail').value,
        clientPhone: document.getElementById('clientPhone').value,
        location: document.getElementById('sessionLocation').value,
        petNames: document.getElementById('petNames').value,
        notes: document.getElementById('sessionNotes').value
      };
      
      // Add to booked dates
      if (!bookedDates.includes(formData.date)) {
        bookedDates.push(formData.date);
      }
      
      // Create client data entry
      sampleClientData[formData.date] = {
        sessionData: {
          session: getSessionTypeName(formData.type),
          park: getLocationName(formData.location),
          selectedDateTime: formData.date + 'T' + formData.time + ':00',
          sessionType: formData.type,
          notes: formData.notes
        },
        intakeData: {
          person1: {
            name: formData.clientName,
            email: formData.clientEmail,
            phone: formData.clientPhone,
            zip: '80000' // Default, would be collected in full form
          },
          pet1: {
            name: formData.petNames.split(',')[0].trim(),
            age: 'Unknown',
            gender: 'Unknown',
            behavior: 'To be determined',
            offLeash: 'unknown',
            favoriteToy: 'Unknown'
          },
          specialRequests: formData.notes || 'None',
          photoStyle: 'both'
        },
        hasGallery: false,
        sessionId: generateSessionId(formData.clientPhone),
        password: generatePassword(formData.petNames.split(',')[0].trim())
      };
      
      // Close modal and refresh
      closeModal('addSessionModal');
      generateCalendar();
      
      alert(`‚úÖ Session Created!\n\nClient: ${formData.clientName}\nDate: ${formData.date}\nTime: ${formData.time}\nLocation: ${getLocationName(formData.location)}\n\nSession has been added to your calendar.`);
      
      // Select the new session
      selectDate(formData.date, document.querySelector(`[data-date="${formData.date}"]`), new Date(formData.date));
      
      // Reset form
      this.reset();
    });

    function showEditSessionModal(dateString) {
      const sessionData = sampleClientData[dateString];
      if (!sessionData) {
        alert('No session data found for this date');
        return;
      }
      
      const modal = document.getElementById('editSessionModal');
      
      // Populate form with existing data
      document.getElementById('editSessionType').value = sessionData.sessionData.sessionType || 'full';
      document.getElementById('editSessionDate').value = dateString;
      document.getElementById('editSessionTime').value = sessionData.sessionData.selectedDateTime ? 
        sessionData.sessionData.selectedDateTime.split('T')[1].slice(0, 5) : '18:00';
      document.getElementById('editClientName').value = sessionData.intakeData.person1.name;
      document.getElementById('editClientEmail').value = sessionData.intakeData.person1.email;
      document.getElementById('editClientPhone').value = sessionData.intakeData.person1.phone;
      document.getElementById('editSessionLocation').value = getLocationCode(sessionData.sessionData.park);
      document.getElementById('editPetNames').value = sessionData.intakeData.pet1.name + 
        (sessionData.intakeData.pet2 ? ', ' + sessionData.intakeData.pet2.name : '');
      document.getElementById('editSessionNotes').value = sessionData.sessionData.notes || '';
      
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    document.getElementById('editSessionForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const originalDate = document.getElementById('editSessionDate').value;
      const formData = {
        type: document.getElementById('editSessionType').value,
        date: document.getElementById('editSessionDate').value,
        time: document.getElementById('editSessionTime').value,
        clientName: document.getElementById('editClientName').value,
        clientEmail: document.getElementById('editClientEmail').value,
        clientPhone: document.getElementById('editClientPhone').value,
        location: document.getElementById('editSessionLocation').value,
        petNames: document.getElementById('editPetNames').value,
        notes: document.getElementById('editSessionNotes').value
      };
      
      // Update client data
      if (sampleClientData[originalDate]) {
        const clientData = sampleClientData[originalDate];
        
        // Update session data
        clientData.sessionData.session = getSessionTypeName(formData.type);
        clientData.sessionData.park = getLocationName(formData.location);
        clientData.sessionData.selectedDateTime = formData.date + 'T' + formData.time + ':00';
        clientData.sessionData.sessionType = formData.type;
        clientData.sessionData.notes = formData.notes;
        
        // Update client data
        clientData.intakeData.person1.name = formData.clientName;
        clientData.intakeData.person1.email = formData.clientEmail;
        clientData.intakeData.person1.phone = formData.clientPhone;
        clientData.intakeData.pet1.name = formData.petNames.split(',')[0].trim();
        clientData.intakeData.specialRequests = formData.notes || 'None';
        
        // If date changed, move the data
        if (originalDate !== formData.date) {
          sampleClientData[formData.date] = clientData;
          delete sampleClientData[originalDate];
          
          // Update booked dates
          const oldIndex = bookedDates.indexOf(originalDate);
          if (oldIndex > -1) {
            bookedDates.splice(oldIndex, 1);
          }
          if (!bookedDates.includes(formData.date)) {
            bookedDates.push(formData.date);
          }
        }
      }
      
      closeModal('editSessionModal');
      generateCalendar();
      
      alert(`‚úÖ Session Updated!\n\nClient: ${formData.clientName}\nDate: ${formData.date}\nTime: ${formData.time}\n\nChanges have been saved.`);
      
      // Show updated session
      showClientProfile(formData.date);
    });

    // Helper functions
    function getSessionTypeName(type) {
      const types = {
        'full': 'Full Session',
        'mini': 'Mini Session', 
        'headshots': 'Pet Headshots',
        'event': 'Special Event'
      };
      return types[type] || 'Full Session';
    }

    function getLocationName(code) {
      const locations = {
        'cheesman': 'Cheesman Park',
        'wash': 'Washington Park',
        'city': 'City Park',
        'sloan': "Sloan's Lake",
        'studio': 'Studio',
        'client-home': "Client's Home",
        'other': 'Other Location'
      };
      return locations[code] || 'Cheesman Park';
    }

    function getLocationCode(name) {
      const codes = {
        'Cheesman Park': 'cheesman',
        'Washington Park': 'wash',
        'City Park': 'city',
        "Sloan's Lake": 'sloan',
        'Studio': 'studio',
        "Client's Home": 'client-home',
        'Other Location': 'other'
      };
      return codes[name] || 'cheesman';
    }

    function generateSessionId(phone) {
      return phone.slice(-4) + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
    }

    function generatePassword(petName) {
      return petName.toLowerCase().replace(/[^a-z]/g, '') + 'barks';
    }

    // Show client profile for selected session
    function showClientProfile(dateString) {
      const clientData = sampleClientData[dateString];
      
      if (!clientData) {
        showDefaultPanel();
        return;
      }
      
      // Hide default panel, show client panel
      document.getElementById('defaultPanel').style.display = 'none';
      document.getElementById('clientPanel').classList.add('active');
      
      // Update session header
      const sessionDate = new Date(dateString);
      document.getElementById('sessionTitle').textContent = `${clientData.sessionData.session}`;
      document.getElementById('sessionDate').textContent = sessionDate.toLocaleDateString('en-US', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      }) + ' at ' + (clientData.sessionData.selectedDateTime ? 
        new Date(clientData.sessionData.selectedDateTime).toLocaleTimeString('en-US', {
          hour: 'numeric',
          minute: '2-digit'
        }) : '6:00 PM');
      
      // Populate client information
      const clientInfo = document.getElementById('clientInfo');
      const person1 = clientData.intakeData.person1;
      clientInfo.innerHTML = `
        <div class="info-item">
          <div class="info-label">Name</div>
          <div class="info-value">${person1.name}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Email</div>
          <div class="info-value">${person1.email}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Phone</div>
          <div class="info-value">${person1.phone}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Zip Code</div>
          <div class="info-value">${person1.zip}</div>
        </div>
      `;
      
      // Populate pet information
      const petInfo = document.getElementById('petInfo');
      let petHtml = '';
      
      if (clientData.intakeData.pet1) {
        const pet1 = clientData.intakeData.pet1;
        petHtml += `
          <div class="pet-card">
            <div class="pet-name">${pet1.name}</div>
            <div class="pet-details">
              <div><strong>Age:</strong> ${pet1.age}</div>
              <div><strong>Gender:</strong> ${pet1.gender}</div>
              <div><strong>Off-leash:</strong> ${pet1.offLeash}</div>
              <div><strong>Toy:</strong> ${pet1.favoriteToy}</div>
            </div>
            <div style="margin-top: 0.5rem; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
              <strong>Behavior:</strong> ${pet1.behavior}
            </div>
          </div>
        `;
      }
      
      if (clientData.intakeData.pet2) {
        const pet2 = clientData.intakeData.pet2;
        petHtml += `
          <div class="pet-card">
            <div class="pet-name">${pet2.name}</div>
            <div class="pet-details">
              <div><strong>Age:</strong> ${pet2.age}</div>
              <div><strong>Gender:</strong> ${pet2.gender}</div>
              <div><strong>Off-leash:</strong> ${pet2.offLeash}</div>
              <div><strong>Toy:</strong> ${pet2.favoriteToy}</div>
            </div>
            <div style="margin-top: 0.5rem; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
              <strong>Behavior:</strong> ${pet2.behavior}
            </div>
          </div>
        `;
      }
      
      petInfo.innerHTML = petHtml;
      
      // Populate session details
      const sessionInfo = document.getElementById('sessionInfo');
      sessionInfo.innerHTML = `
        <div class="info-item">
          <div class="info-label">Session Type</div>
          <div class="info-value">${clientData.sessionData.session}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Location</div>
          <div class="info-value">${clientData.sessionData.park}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Photo Style</div>
          <div class="info-value">${clientData.intakeData.photoStyle}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Special Requests</div>
          <div class="info-value">${clientData.intakeData.specialRequests || 'None'}</div>
        </div>
      `;
      
      // Update password display
      updatePasswordDisplay(clientData);
      
      // Update gallery status
      const galleryStatus = document.getElementById('galleryStatus');
      if (clientData.hasGallery) {
        galleryStatus.className = 'gallery-status has-gallery';
        galleryStatus.innerHTML = `
          <p>‚úÖ Gallery created with 24 photos</p>
          <p style="font-size: 0.9rem; margin-top: 0.5rem;">
            Last updated: ${new Date().toLocaleDateString()}
          </p>
        `;
      } else {
        galleryStatus.className = 'gallery-status no-gallery';
        galleryStatus.innerHTML = '<p>No gallery created yet for this session</p>';
      }
    }

    // Update password display
    function updatePasswordDisplay(clientData) {
      const passwordDisplay = document.getElementById('passwordDisplay');
      const sessionId = clientData.sessionId || generateSessionId(clientData.intakeData.person1.phone);
      const password = clientData.password || generatePassword(clientData.intakeData.pet1.name);
      
      passwordDisplay.innerHTML = `
        <div class="password-item">
          <div>
            <strong>Session ID:</strong> ${sessionId}
          </div>
          <div class="password-actions">
            <button class="btn btn-small" onclick="copyToClipboard('${sessionId}')">üìã Copy</button>
            <button class="btn btn-small" onclick="regenerateSessionId()">üîÑ</button>
          </div>
        </div>
        <div class="password-item">
          <div>
            <strong>Password:</strong> ${password}
          </div>
          <div class="password-actions">
            <button class="btn btn-small" onclick="copyToClipboard('${password}')">üìã Copy</button>
            <button class="btn btn-small" onclick="regeneratePassword()">üîÑ</button>
          </div>
        </div>
        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.9rem; color: rgba(255,255,255,0.7);">
          <strong>Gallery URL:</strong> ${window.location.origin}/gallery-login.html
        </div>
      `;
      
      // Update stored data
      clientData.sessionId = sessionId;
      clientData.password = password;
    }

    // Show default panel
    function showDefaultPanel() {
      document.getElementById('clientPanel').classList.remove('active');
      document.getElementById('defaultPanel').style.display = 'block';
    }

    // Session management functions
    function editSession() {
      if (!selectedDate) {
        alert('Please select a session date first');
        return;
      }
      showEditSessionModal(selectedDate);
    }

    function cancelSession() {
      if (!selectedDate) {
        alert('Please select a session date first');
        return;
      }
      
      if (confirm('‚ö†Ô∏è Cancel Session\n\nAre you sure you want to cancel this session? This action cannot be undone.')) {
        // Remove from booked dates
        const index = bookedDates.indexOf(selectedDate);
        if (index > -1) {
          bookedDates.splice(index, 1);
        }
        
        // Remove client data
        delete sampleClientData[selectedDate];
        
        generateCalendar();
        showDefaultPanel();
        
        alert('‚úÖ Session cancelled and removed from calendar');
      }
    }

    function rescheduleSession() {
      if (!selectedDate) {
        alert('Please select a session date first');
        return;
      }
      
      alert('üìÖ Reschedule Session\n\nIn the full version, this would:\n\n‚Ä¢ Show available dates\n‚Ä¢ Allow drag-and-drop rescheduling\n‚Ä¢ Send notification to client\n‚Ä¢ Update Google Calendar\n‚Ä¢ Preserve all session data');
    }

    function duplicateSession() {
      if (!selectedDate) {
        alert('Please select a session date first');
        return;
      }
      
      const clientData = sampleClientData[selectedDate];
      if (!clientData) {
        alert('No session data found');
        return;
      }
      
      // Pre-fill add session form with existing data
      const modal = document.getElementById('addSessionModal');
      document.getElementById('sessionType').value = clientData.sessionData.sessionType || 'full';
      document.getElementById('clientName').value = clientData.intakeData.person1.name;
      document.getElementById('clientEmail').value = clientData.intakeData.person1.email;
      document.getElementById('clientPhone').value = clientData.intakeData.person1.phone;
      document.getElementById('sessionLocation').value = getLocationCode(clientData.sessionData.park);
      document.getElementById('petNames').value = clientData.intakeData.pet1.name + 
        (clientData.intakeData.pet2 ? ', ' + clientData.intakeData.pet2.name : '');
      document.getElementById('sessionNotes').value = clientData.sessionData.notes || '';
      
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    // Password management functions
    function regenerateSessionId() {
      if (!selectedDate || !sampleClientData[selectedDate]) {
        alert('Please select a session first');
        return;
      }
      
      const clientData = sampleClientData[selectedDate];
      const newSessionId = generateSessionId(clientData.intakeData.person1.phone);
      clientData.sessionId = newSessionId;
      
      updatePasswordDisplay(clientData);
      alert(`üÜî New Session ID Generated!\n\nNew ID: ${newSessionId}\n\nClients will need the new credentials to access their gallery.`);
    }

    function regeneratePassword() {
      if (!selectedDate || !sampleClientData[selectedDate]) {
        alert('Please select a session first');
        return;
      }
      
      const clientData = sampleClientData[selectedDate];
      const newPassword = generatePassword(clientData.intakeData.pet1.name) + Math.floor(Math.random() * 100);
      clientData.password = newPassword;
      
      updatePasswordDisplay(clientData);
      alert(`üîê New Password Generated!\n\nNew Password: ${newPassword}\n\nClients will need the new credentials to access their gallery.`);
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        // Create temporary notification
        const notification = document.createElement('div');
        notification.textContent = 'üìã Copied to clipboard!';
        notification.style.cssText = `
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: linear-gradient(135deg, var(--available-green), #059669);
          color: white;
          padding: 1rem 2rem;
          border-radius: 8px;
          z-index: 9999;
          font-weight: 600;
          box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        `;
        
        document.body.appendChild(notification);
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 2000);
      }).catch(() => {
        alert(`üìã Copy this text:\n\n${text}`);
      });
    }

    // Enhanced gallery management functions
    function createGallery() {
      if (!selectedDate) {
        alert('Please select a session date first');
        return;
      }
      
      const clientData = sampleClientData[selectedDate];
      if (!clientData) {
        alert('No client data found for this session');
        return;
      }
      
      if (clientData.hasGallery) {
        alert('üì∏ Gallery Already Exists\n\nThis session already has a gallery. Use "Upload Photos" to add more images or "View Gallery" to see the current photos.');
        return;
      }
      
      const sessionId = clientData.sessionId;
      const password = clientData.password;
      
      // Simulate gallery creation process
      alert(`üé® Creating Gallery...\n\nInitializing photo gallery for ${clientData.intakeData.person1.name}'s session.\n\nThis process will:\n‚Ä¢ Create secure gallery space\n‚Ä¢ Set up client access\n‚Ä¢ Prepare upload interface\n\nPlease wait...`);
      
      setTimeout(() => {
        clientData.hasGallery = true;
        showClientProfile(selectedDate);
        
        alert(`üéâ Gallery Created Successfully!\n\nClient: ${clientData.intakeData.person1.name}\nSession ID: ${sessionId}\nPassword: ${password}\n\nYou can now upload photos and send access credentials to your client.`);
      }, 1500);
    }

    function uploadPhotos() {
      if (!selectedDate) {
        alert('Please select a session date first');
        return;
      }
      
      const clientData = sampleClientData[selectedDate];
      if (!clientData) {
        alert('No client data found for this session');
        return;
      }
      
      if (!clientData.hasGallery) {
        if (confirm('üì∏ No Gallery Found\n\nThis session doesn\'t have a gallery yet. Would you like to create one now?')) {
          createGallery();
          return;
        }
        return;
      }
      
      // Simulate advanced photo upload interface
      const uploadDetails = `üì∑ Photo Upload Interface\n\nIn the full version, this would provide:\n\nüñ±Ô∏è Drag & Drop Upload\n‚Ä¢ Bulk photo selection\n‚Ä¢ Progress indicators\n‚Ä¢ Thumbnail previews\n\n‚öôÔ∏è Auto-Processing\n‚Ä¢ Resize for web viewing\n‚Ä¢ Generate thumbnails\n‚Ä¢ Apply watermarks\n\nüì± Organization Tools\n‚Ä¢ Auto-sort by timestamp\n‚Ä¢ Batch rename options\n‚Ä¢ Category tagging\n\nüéØ Quality Control\n‚Ä¢ Duplicate detection\n‚Ä¢ Blur/focus analysis\n‚Ä¢ Color correction options\n\nWould you like to simulate uploading 24 photos?`;
      
      if (confirm(uploadDetails)) {
        alert('üì§ Upload Started!\n\nSimulating upload of 24 high-resolution photos...\n\n‚úÖ Processing complete!\nPhotos are now available in the client gallery.');
      }
    }

    function viewGallery() {
      if (!selectedDate) {
        alert('Please select a session date first');
        return;
      }
      
      const clientData = sampleClientData[selectedDate];
      if (!clientData || !clientData.hasGallery) {
        alert('No gallery found for this session. Create a gallery first.');
        return;
      }
      
      // Open gallery in new tab with admin access
      const galleryUrl = `/gallery.html?session=${clientData.sessionId}&admin=true`;
      window.open(galleryUrl, '_blank');
    }

    function sendCredentials() {
      if (!selectedDate) {
        alert('Please select a session date first');
        return;
      }
      
      const clientData = sampleClientData[selectedDate];
      if (!clientData) {
        alert('No client data found for this session');
        return;
      }
      
      if (!clientData.hasGallery) {
        alert('Please create a gallery first before sending credentials');
        return;
      }
      
      const sessionId = clientData.sessionId;
      const password = clientData.password;
      const clientEmail = clientData.intakeData.person1.email;
      const clientName = clientData.intakeData.person1.name;
      const petName = clientData.intakeData.pet1.name;
      
      // Simulate sending email with credentials
      const emailPreview = `üìß Email Preview\n\nTo: ${clientEmail}\nSubject: Your Pet Photography Gallery is Ready! üì∏\n\n---\n\nHi ${clientName}!\n\nYour beautiful photos with ${petName} are now ready to view and download!\n\nüîó Gallery Access:\nWebsite: ${window.location.origin}/gallery-login.html\nSession ID: ${sessionId}\nPassword: ${password}\n\n‚ú® Features:\n‚Ä¢ View all your photos\n‚Ä¢ Download high-resolution images\n‚Ä¢ Share favorites with friends\n‚Ä¢ Available for 90 days\n\nEnjoy your memories!\n\nüì∏ Picture This Pet Team`;
      
      if (confirm(emailPreview + '\n\n---\n\nSend this email to the client?')) {
        alert('‚úÖ Credentials Sent!\n\nAccess credentials have been emailed to:\n' + clientEmail + '\n\nThe client can now view and download their photos using the provided login information.');
      }
    }

    // Calendar navigation
    function previousMonth() {
      currentMonth.setMonth(currentMonth.getMonth() - 1);
      if (calendarLoaded) {
        generateCalendar();
      }
    }

    function nextMonth() {
      currentMonth.setMonth(currentMonth.getMonth() + 1);
      if (calendarLoaded) {
        generateCalendar();
      }
    }

    function refreshCalendar() {
      console.log('Refreshing admin calendar...');
      // Reset mode
      currentMode = 'view';
      document.querySelectorAll('.tool-btn').forEach(btn => {
        btn.style.background = '';
        if (btn.textContent.includes('Block')) {
          btn.textContent = 'üö´ Block Time';
        } else if (btn.textContent.includes('Edit')) {
          btn.textContent = '‚úèÔ∏è Edit Mode';
        }
      });
      fetchCalendarData();
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Admin dashboard loaded, initializing...');
      
      // Check authentication first
      if (!checkAuthentication()) {
        return;
      }
      
      // Fetch calendar data
      fetchCalendarData();
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      // Close modals with escape
      if (e.key === 'Escape') {
        // Close any open modals
        document.querySelectorAll('.modal-overlay').forEach(modal => {
          if (modal.style.display === 'flex') {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
          }
        });
        
        // Hide context menu
        hideContextMenu();
        
        // Return to default panel and clear selection
        showDefaultPanel();
        document.querySelectorAll('.calendar-day.selected').forEach(el => {
          el.classList.remove('selected');
        });
        
        // Reset mode
        currentMode = 'view';
      }
      
      // Quick actions
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 'n':
            e.preventDefault();
            showAddSessionModal();
            break;
          case 'r':
            e.preventDefault();
            refreshCalendar();
            break;
        }
      }
    });

    // Click outside to close context menu
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.context-menu') && !e.target.closest('.calendar-day')) {
        hideContextMenu();
      }
    });
  </script>
</body>
</html>
