<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Schedule Your Session | Picture This Pet</title>
  <meta name="description" content="Schedule your pet photography session with Picture This Pet.">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --orange: #F47C2C;
      --gold: #FDB75E;
      --dark-brown: #4B2E1E;
      --available-green: #10b981;
      --booked-red: #ef4444;
      --soft-hold-yellow: #f59e0b;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      overflow-x: hidden;
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: white;
      background-image: url('assets/images/main_background_allsystem.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      overflow-x: hidden;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    @keyframes moveBackground {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-10px); }
      60% { transform: translateY(-5px); }
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.8; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes progressFill {
      0% { width: 0%; }
      100% { width: 100%; }
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    header {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.01rem 1.5rem;
      padding-top: calc(0.01rem + env(safe-area-inset-top));
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: cover;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 32px rgba(0,0,0, 0.3);
      border-bottom: 1px solid rgba(255,255,255, 0.1);
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
      height: calc(110px + env(safe-area-inset-top));
    }

    .desktop-logo {
      height: 100px;
    }

    .logo-link {
      display: flex;
      align-items: center;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .site-nav {
      display: flex;
      align-items: center;
      margin-left: auto;
    }

    .site-nav a:not(.book-btn) {
      margin-left: 1rem;
      text-decoration: none;
      font-weight: 600;
      color: white;
      transition: all 0.3s ease;
      padding: 0.5rem 1rem;
      border-radius: 8px;
    }

    .book-btn {
      background: linear-gradient(135deg, var(--orange), var(--gold));
      color: white;
      padding: 0.8rem 2rem;
      border: none;
      border-radius: 999px;
      font-weight: 900;
      font-size: 1.2rem;
      text-decoration: none;
      margin-left: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(244,124,44, 0.3);
    }

    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 2rem;
      cursor: pointer;
    }

    main {
      margin-top: 110px;
      flex: 1;
      padding: 2rem 1rem;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      min-height: calc(100vh - 110px);
    }

    .booking-container {
      max-width: 1200px;
      width: 100%;
      margin: 0 auto;
      background: rgba(255,255,255, 0.05);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255, 0.1);
      padding: 3rem;
      animation: fadeInUp 0.8s ease-out;
      min-height: auto;
      position: relative;
      overflow: visible;
    }

    .page-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .page-title {
      font-family: 'Playfair Display', serif;
      font-size: 2.8rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.5rem; /* Increased to create more space */
      text-shadow: 0 2px 8px rgba(0,0,0, 0.3);
    }

    .page-subtitle {
      font-size: 1.2rem;
      color: rgba(255,255,255, 0.7);
      font-weight: 500;
      line-height: 1;
    }

    .booking-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      position: relative;
      width: 100%;
      min-height: auto;
      padding: 0;
      gap: 0;
    }

    .loading-area {
      text-align: center;
      transition: all 0.8s ease;
      width: 100%;
      overflow: hidden;
    }

    .loading-area.hidden {
      opacity: 0;
      transform: translateY(-30px);
      pointer-events: none;
      height: 0;
      margin: 0;
    }

    .confirmation-message {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
      border: 1px solid var(--available-green);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      text-align: center;
    }

    .confirmation-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      animation: pulse 2s infinite;
    }

    .confirmation-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--available-green);
      margin-bottom: 0.8rem;
    }

    .confirmation-description {
      font-size: 1rem;
      color: rgba(255,255,255, 0.8);
      line-height: 1.6;
    }

    .loading-animation {
      margin: 1rem 0;
    }

    .loading-spinner {
      width: 70px;
      height: 70px;
      border: 5px solid rgba(255,255,255, 0.3);
      border-top: 5px solid var(--gold);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    .paw-prints {
      display: flex;
      justify-content: center;
      gap: 1.2rem;
      margin: 1rem 0;
    }

    .paw {
      font-size: 1.8rem;
      animation: bounce 1.5s infinite;
    }

    .paw:nth-child(1) { animation-delay: 0s; }
    .paw:nth-child(2) { animation-delay: 0.3s; }
    .paw:nth-child(3) { animation-delay: 0.6s; }
    .paw:nth-child(4) { animation-delay: 0.9s; }

    .loading-text {
      font-size: 1.3rem;
      color: rgba(255,255,255, 0.8);
      margin: 1rem 0;
      background: linear-gradient(90deg, rgba(255,255,255,0.6) 0%, rgba(253,183,94,1) 50%, rgba(255,255,255,0.6) 100%);
      background-size: 200% 100%;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 2s ease-in-out infinite;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(255,255,255, 0.2);
      border-radius: 3px;
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--orange), var(--gold));
      border-radius: 3px;
      animation: progressFill 3s ease-out forwards;
    }

    .acuity-container {
      opacity: 0;
      transform: scale(0.95);
      transition: all 0.8s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      margin-top: 0;
    }

    .acuity-container.show {
      opacity: 1;
      transform: scale(1);
    }

    .acuity-iframe {
      border: none;
      border-radius: 16px;
      background: white;
      box-shadow: 0 5px 15px rgba(0,0,0, 0.2);
      width: 100%;
      max-width: 900px;
      height: auto; /* Will be set dynamically via JavaScript */
    }

    .agreements-section {
      margin-top: 2rem;
      padding: 2rem;
      background: rgba(255,255,255, 0.1);
      border-radius: 16px;
      width: 100%;
      max-width: 1200px;
    }

    .agreements-section h2 {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      font-weight: 700;
      color: white;
      margin-bottom: 1rem;
      text-shadow: 0 2px 8px rgba(0,0,0, 0.3);
    }

    .agreements-section h3 {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--gold);
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .agreements-section p, .agreements-section ul {
      font-size: 1rem;
      color: rgba(255,255,255, 0.8);
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .agreements-section ul {
      padding-left: 1.5rem;
      list-style-type: disc;
    }

    .agreements-section li {
      margin-bottom: 0.5rem;
    }

    footer {
      background-image: url('assets/images/ani_bkgd_cool.png');
      background-size: 100% 100%;
      background-position: center;
      animation: moveBackground 30s ease-in-out infinite;
      border-top: 1px solid rgba(255,255,255, 0.1);
      padding: 2rem 1.5rem;
      color: rgba(255,255,255, 0.5);
      font-size: 0.9rem;
    }

    .footer-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      margin-bottom: 1.5rem;
    }

    .footer-section {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .footer-section h4 {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      font-size: 1.2rem;
      color: white;
      margin-bottom: 1rem;
    }

    .footer-section a {
      color: rgba(255,255,255, 0.7);
      text-decoration: none;
      display: block;
      margin-bottom: 0.5rem;
      transition: color 0.3s ease;
    }

    .footer-section a:hover {
      color: var(--gold);
    }

    .payment-methods {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .payment-icon {
      width: 40px;
      height: 25px;
      object-fit: contain;
      opacity: 0.7;
      transition: opacity 0.3s ease;
    }

    .payment-icon:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    .footer-bottom {
      text-align: center;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255,255,255, 0.1);
    }

    .footer-bottom .site-creation-link {
      white-space: nowrap;
    }

    @media (max-width: 1024px) {
      .acuity-iframe {
        height: auto;
      }
    }

    @media (max-width: 768px) {
      header {
        height: 80px;
        padding: 0.5rem 1rem;
        height: calc(80px + env(safe-area-inset-top));
      }

      .desktop-logo {
        height: 48px;
      }

      .mobile-menu-btn {
        display: block;
      }

      .site-nav {
        display: none;
      }

      main {
        margin-top: calc(80px + env(safe-area-inset-top));
        padding: 0;
        min-height: auto; /* Allow main to grow with content */
      }

      .booking-container {
        padding: 0;
        min-height: auto;
        border-radius: 0;
        border: none;
      }

      .page-header {
        margin-bottom: 0;
        padding: 0;
      }

      .page-title {
        font-size: 2.2rem;
      }

      .page-subtitle {
        margin-bottom: 0;
        padding-bottom: 0;
        line-height: 0.8;
      }

      .confirmation-message {
        padding: 0.5rem;
        margin-bottom: 0;
      }

      .loading-animation {
        margin: 0;
      }

      .loading-spinner {
        margin-bottom: 0.5rem;
      }

      .paw-prints {
        margin: 0.5rem 0;
      }

      .loading-text {
        margin: 0.5rem 0;
      }

      .progress-bar {
        margin: 0.5rem 0;
      }

      .acuity-container {
        margin-top: 0; /* Adjusted to position iframe below subheader */
        padding: 0;
        margin-bottom: 0;
      }

      .acuity-iframe {
        height: auto;
        border-radius: 0;
        box-shadow: none;
      }

      .agreements-section {
        margin-top: 1rem;
        padding: 1rem;
      }

      .agreements-section h2 {
        font-size: 1.8rem;
      }

      .agreements-section h3 {
        font-size: 1.3rem;
      }

      .agreements-section p, .agreements-section ul {
        font-size: 0.9rem;
      }

      .footer-container {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .footer-section {
        align-items: center;
        text-align: center;
      }
    }

    @media (max-width: 480px) {
      .booking-container {
        padding: 0;
        margin: 0;
      }

      .page-title {
        font-size: 2rem;
      }

      .confirmation-message {
        padding: 0.3rem;
      }

      .acuity-iframe {
        height: auto;
      }
    }
  </style>
</head>
<body>
  <header>
    <a href="/" class="logo-link" aria-label="PictureThisPet Home">
      <img src="assets/images/headerlogowarm.png" alt="PictureThisPet Logo" class="desktop-logo" />
    </a>
    <nav class="site-nav">
      <a href="/" aria-label="Home page">Home</a>
      <a href="/availability.html" aria-label="Availability page">Availability</a>
      <a href="/locations.html" aria-label="Locations page">Locations</a>
      <a href="/pricing" aria-label="Pricing page">Pricing</a>
      <a href="/contact" aria-label="Contact page">Contact</a>
      <a href="/cart.html" class="book-btn" aria-label="Book a session">Book Now</a>
    </nav>
    <button class="mobile-menu-btn" aria-label="Toggle mobile menu" onclick="toggleMenu()">‚ò∞</button>
  </header>

  <main>
    <div class="booking-container">
      <div class="page-header">
        <h1 class="page-title">üìÖ Schedule Your Session</h1>
        <p class="page-subtitle">Book a time slot for your pet photography session</p>
      </div>

      <div class="booking-section">
        <!-- Loading Area -->
        <div class="loading-area" id="loadingArea">
          <div class="confirmation-message">
            <div class="confirmation-icon">‚úÖ‚ú®</div>
            <h3 class="confirmation-title">Payment Confirmed!</h3>
            <p class="confirmation-description">Your payment has been successfully processed. Let‚Äôs schedule your session with Picture This Pet! üêæ</p>
          </div>

          <div class="loading-animation">
            <div class="loading-spinner"></div>
            
            <div class="paw-prints">
              <span class="paw">üêæ</span>
              <span class="paw">üêæ</span>
              <span class="paw">üêæ</span>
              <span class="paw">üêæ</span>
            </div>

            <div class="loading-text" id="loadingText">üìÖ Loading scheduling portal...</div>

            <div class="progress-bar">
              <div class="progress-fill"></div>
            </div>
          </div>
        </div>

        <!-- Acuity Container -->
        <div class="acuity-container" id="acuityContainer">
          <iframe class="acuity-iframe" id="acuityIframe" src="" title="Acuity Scheduling" scrolling="no"></iframe>
        </div>

        <!-- Agreements and Policies Section -->
        <div class="agreements-section">
          <h2>PictureThisPet Agreements and Policies</h2>

          <h3>Session Details</h3>
          <ul>
            <li><strong>Session Locations</strong>: Sessions are conducted at Cheesman Park or City Park in Denver, as selected by the client during booking. Additional locations may be accommodated for an extra fee, subject to availability.</li>
            <li><strong>Session Duration</strong>: Full sessions last approximately 90 minutes, while Mini sessions last 60 minutes. Duration may vary based on the pet's comfort and behavior.</li>
            <li><strong>Participants</strong>: Sessions include up to 2 pets and 2 people from the same household, as specified in the booking. Additional pets or people can be included for an extra fee of $50 per pet or person.</li>
            <li><strong>Scheduling</strong>: Sessions must be booked via the website (picturethispet.co) or by contacting info@picturethispet.co. Priority scheduling is available for urgent bookings (e.g., elderly or ill pets).</li>
          </ul>

          <h3>Payment Terms</h3>
          <ul>
            <li><strong>Additional Fees</strong>: Fees for extra pets, people, or locations must be paid at the time of booking. All prices are subject to change without notice.</li>
            <li><strong>Payment Methods</strong>: We accept all major credit cards, Apple Pay, Google Pay, PayPal, and other methods listed in the footer of picturethispet.co.</li>
            <li><strong>Product Purchases</strong>: Digital images, prints, and albums are available for purchase after the session. Pricing is provided during the ordering session, with no obligation to purchase.</li>
          </ul>

          <h3>Cancellation and Rescheduling</h3>
          <ul>
            <li><strong>Cancellations</strong>: Cancellations with less than 48 hours' notice forfeit the deposit. Cancellations with more than 48 hours' notice can reschedule once without penalty.</li>
            <li><strong>Rescheduling</strong>: Rescheduling requests must be made at least 48 hours before the session. One reschedule is permitted at no cost; additional reschedules incur a $25 fee.</li>
            <li><strong>Weather Policy</strong>: For outdoor sessions, if weather conditions are unsuitable (e.g., rain, extreme heat), the session will be rescheduled at no cost. PictureThisPet will work with clients to find a suitable date.</li>
          </ul>

          <h3>Liability and Safety</h3>
          <ul>
            <li><strong>Client Responsibility</strong>: Clients are responsible for their pets‚Äô behavior during the session. Any property damage or accidents (e.g., pet waste, bites) are the client‚Äôs responsibility. Clients must disclose any behavioral issues (e.g., aggression) prior to the session.</li>
            <li><strong>Vaccination Clause</strong>: Clients must confirm that pets are up-to-date on vaccinations, including rabies, to ensure safety for all parties. PictureThisPet reserves the right to cancel a session if vaccination status is not verified.</li>
            <li><strong>Release of Liability</strong>: PictureThisPet is not liable for injuries, damages, or illnesses that occur during the session, including those caused by pets or environmental factors at Cheesman Park or City Park.</li>
            <li><strong>Pet Welfare</strong>: The pet‚Äôs comfort and safety are prioritized. Sessions will be adjusted or paused if a pet shows signs of distress. Clients are encouraged to bring treats, toys, or familiar items to keep pets at ease.</li>
          </ul>

          <h3>Image Usage Rights</h3>
          <ul>
            <li><strong>Copyright</strong>: PictureThisPet retains copyright to all images taken during the session. Clients receive a personal-use license to share and print images for non-commercial purposes, provided they credit PictureThisPet (@picturethispet on Instagram).</li>
            <li><strong>Client Usage</strong>: Clients may not use images for commercial purposes (e.g., advertising, merchandise) without written permission and additional licensing fees.</li>
            <li><strong>Photographer Usage</strong>: PictureThisPet may use session images for promotional purposes, including on the website, social media, and marketing materials, unless the client opts out in writing prior to the session.</li>
            <li><strong>Digital Files and Prints</strong>: Digital files and prints are available for purchase after the session. Digital files include a personal-use license; prints ordered through PictureThisPet do not require a separate print release.</li>
          </ul>

          <h3>Session Conduct</h3>
          <ul>
            <li><strong>Preparation</strong>: Clients should ensure pets are groomed, fed, and have had a bathroom break before the session to minimize disruptions. Bring treats or toys to encourage cooperation.</li>
            <li><strong>Control of Pets</strong>: Clients must remain within arm‚Äôs reach of their pets at all times. Pets must be on a leash or in a carrier when not actively being photographed, per park regulations.</li>
            <li><strong>Props and Outfits</strong>: Clients may bring props or blankets for the session. PictureThisPet does not provide props for sanitary reasons.</li>
          </ul>

          <h3>Post-Session</h3>
          <ul>
            <li><strong>Image Delivery</strong>: Clients will receive a gallery of edited images within 2 weeks of the session. Images are available for purchase for 14 days; after this period, images may be archived.</li>
            <li><strong>Final Sale</strong>: All product sales (digital files, prints, albums) are final. No refunds will be issued after purchase.</li>
            <li><strong>Satisfaction Guarantee</strong>: If clients are unsatisfied with the session, they may request a complimentary reshoot within 30 days, subject to availability.</li>
          </ul>

          <h3>Privacy Policy</h3>
          <ul>
            <li><strong>Data Collection</strong>: PictureThisPet collects client names, contact information, and pet details for booking and communication purposes only. This information is not shared with third parties.</li>
            <li><strong>Website Usage</strong>: By using picturethispet.co, clients agree to the website‚Äôs terms of use and privacy policy, available at the footer of the site.</li>
          </ul>

          <h3>Disputes</h3>
          <ul>
            <li><strong>Governing Law</strong>: Any disputes arising from this agreement will be resolved under the laws of the State of Colorado. Both parties agree to resolve conflicts amicably before pursuing legal action.</li>
          </ul>

          <p>For further inquiries, contact PictureThisPet at info@picturethispet.co or via Instagram @picturethispet.</p>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-container">
      <div class="footer-section">
        <h4>Contact Us</h4>
        <a href="mailto:info@picturethispet.co" aria-label="Email us at info@picturethispet.co">Email Us</a>
        <a href="https://picturethispet.co" aria-label="Visit our website picturethispet.co">picturethispet.co</a>
      </div>
      <div class="footer-section socials">
        <h4>Connect</h4>
        <a href="https://instagram.com/picturethispet" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Instagram">Instagram</a>
        <a href="/subscribe" aria-label="Subscribe to our newsletter">Subscribe</a>
      </div>
      <div class="footer-section">
        <h4>We Accept</h4>
        <div class="payment-methods">
          <img src="assets/images/payments/visa.png" alt="Visa payment accepted" class="payment-icon" />
          <img src="assets/images/payments/mastercard.png" alt="MasterCard payment accepted" class="payment-icon" />
          <img src="assets/images/payments/amex.png" alt="American Express payment accepted" class="payment-icon" />
          <img src="assets/images/payments/discover.png" alt="Discover payment accepted" class="payment-icon" />
          <img src="assets/images/payments/applepay.png" alt="Apple Pay payment accepted" class="payment-icon" />
          <img src="assets/images/payments/googlepay.png" alt="Google Pay payment accepted" class="payment-icon" />
          <img src="assets/images/payments/samsungpay.png" alt="Samsung Pay payment accepted" class="payment-icon" />
          <img src="assets/images/payments/amazonpay.png" alt="Amazon Pay payment accepted" class="payment-icon" />
          <img src="assets/images/payments/klarna.png" alt="Klarna payment accepted" class="payment-icon" />
          <img src="assets/images/payments/affirm.png" alt="Affirm payment accepted" class="payment-icon" />
          <img src="assets/images/payments/afterpay.png" alt="Afterpay payment accepted" class="payment-icon" />
          <img src="assets/images/payments/cashapp.png" alt="Cash App payment accepted" class="payment-icon" />
          <img src="assets/images/payments/paypal.png" alt="PayPal payment accepted" class="payment-icon" />
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>¬© 2025 PictureThisPet. All rights reserved. | v1.0.19 | Last updated: 04:26 AM MDT, May 27, 2025 | <a href="/site-creation" class="site-creation-link" style="color: var(--gold); text-decoration: underline;" aria-label="Learn how AI built this site">AI built my site. Find out How!</a></p>
    </div>
  </footer>

  <script>
    let sessionData = null;
    let loadingMessages = [
      "üìÖ Loading scheduling portal...",
      "üêæ Preparing your session booking...",
      "‚ú® Connecting to Acuity Scheduling...",
      "üéâ Almost ready to book your slot...",
      "üìÜ Finalizing booking portal..."
    ];
    let messageIndex = 0;

    // Acuity URL mapping with corrected pluralization
    const acuityLinks = {
      "Full at Cheesman (1 person, 1 pet)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78805498",
      "Full at Cheesman (1 person, 2 pets)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78816444",
      "Full at Cheesman (2 people, 1 pet)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78816428",
      "Full at Cheesman (2 people, 2 pets)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78816419",
      "Full at City (1 person, 1 pet)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78816425",
      "Full at City (1 person, 2 pets)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78816441",
      "Full at City (2 people, 1 pet)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78816431",
      "Full at City (2 people, 2 pets)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78802621",
      "Mini at Cheesman (1 person, 1 pet)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78805731",
      "Mini at Cheesman (1 person, 2 pets)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78816464",
      "Mini at Cheesman (2 people, 1 pet)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78816457",
      "Mini at Cheesman (2 people, 2 pets)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78816469",
      "Mini at City (1 person, 1 pet)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78816452",
      "Mini at City (1 person, 2 pets)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78816463",
      "Mini at City (2 people, 1 pet)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78816458",
      "Mini at City (2 people, 2 pets)": "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78816472"
    };

    function updateLoadingText() {
      const loadingTextElement = document.getElementById('loadingText');
      loadingTextElement.textContent = loadingMessages[messageIndex];
      messageIndex = (messageIndex + 1) % loadingMessages.length;
    }

    function loadSessionData() {
      try {
        const storedData = localStorage.getItem('sessionData');
        if (storedData) {
          sessionData = JSON.parse(storedData);
          console.log('Loaded session data:', sessionData);
          return true;
        }
      } catch (e) {
        console.error('Error loading session data:', e);
      }
      return false;
    }

    function getAcuityUrl() {
      if (!sessionData || !sessionData.sessionType || !sessionData.location || 
          sessionData.numberOfPets === null || sessionData.numberOfPeople === null) {
        console.error('Missing session data fields:', {
          sessionType: sessionData?.sessionType,
          location: sessionData?.location,
          numberOfPets: sessionData?.numberOfPets,
          numberOfPeople: sessionData?.numberOfPeople
        });
        return null;
      }

      // Normalize location to match acuityLinks keys
      let normalizedLocation = sessionData.location;
      if (sessionData.location === "City Park") {
        normalizedLocation = "City";
      } else if (sessionData.location === "Cheesman Park") {
        normalizedLocation = "Cheesman";
      }

      // Construct session identifier with correct pluralization
      const peopleLabel = sessionData.numberOfPeople === 1 ? "person" : "people";
      const petsLabel = sessionData.numberOfPets === 1 ? "pet" : "pets";
      const sessionIdentifier = `${sessionData.sessionType} at ${normalizedLocation} (${sessionData.numberOfPeople} ${peopleLabel}, ${sessionData.numberOfPets} ${petsLabel})`;
      
      console.log('Raw session data:', {
        sessionType: sessionData.sessionType,
        location: sessionData.location,
        normalizedLocation: normalizedLocation,
        numberOfPeople: sessionData.numberOfPeople,
        numberOfPets: sessionData.numberOfPets
      });
      console.log('Constructed session identifier:', sessionIdentifier);

      const acuityUrl = acuityLinks[sessionIdentifier];
      
      if (!acuityUrl) {
        console.error('No Acuity URL found for session identifier:', sessionIdentifier);
        console.log('Available keys in acuityLinks:', Object.keys(acuityLinks));
        // Fallback URL to prevent redirect
        return "https://app.acuityscheduling.com/schedule.php?owner=35886698&appointmentType=78802621"; // Default to a known Acuity link
      }
      
      return acuityUrl;
    }

    function adjustIframeHeight() {
      const iframe = document.getElementById('acuityIframe');
      if (!iframe) return;

      try {
        const contentHeight = iframe.contentWindow.document.body.scrollHeight;
        iframe.style.height = `${contentHeight}px`;
        console.log('Iframe height set to:', contentHeight);
      } catch (e) {
        console.error('Error accessing iframe content height:', e);
        iframe.style.height = '6000px'; // Doubled fallback height for lengthy intake form
      }
    }

    function showAcuityIframe() {
      const acuityUrl = getAcuityUrl();
      if (!acuityUrl) {
        console.error('No Acuity URL available');
        alert('‚ö†Ô∏è Scheduling URL not found. Please try booking again.');
        window.location.href = '/cart.html';
        return;
      }

      console.log('Loading Acuity URL:', acuityUrl);

      const loadingArea = document.getElementById('loadingArea');
      const acuityContainer = document.getElementById('acuityContainer');
      const acuityIframe = document.getElementById('acuityIframe');

      // Hide loading area
      loadingArea.classList.add('hidden');

      // Set iframe source and show
      acuityIframe.src = acuityUrl;
      
      setTimeout(() => {
        acuityContainer.classList.add('show');
        // Adjust iframe height after it loads
        acuityIframe.onload = adjustIframeHeight;
      }, 500);
    }

    function toggleMenu() {
      const nav = document.querySelector('.site-nav');
      nav.classList.toggle('active');
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('‚úÖ Booking page loaded');
      
      // Load session data
      if (loadSessionData()) {
        // Start loading text rotation
        const textInterval = setInterval(updateLoadingText, 1000);
        
        // Show Acuity iframe after 3 seconds
        setTimeout(() => {
          clearInterval(textInterval);
          showAcuityIframe();
        }, 3000);
      } else {
        // No session data, redirect back to cart
        alert('‚ö†Ô∏è No session data found. Redirecting to session builder...');
        window.location.href = '/cart.html';
      }
    });
  </script>
</body>
</html>
