<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Picture This Pet | Pet Photography in Denver</title>
  <meta name="description" content="Capture the magic of your furry friends with Picture This Pet, Denver's premier pet photography service. Book your session today!">
  <link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/assets/css/styles.css" /> <!-- Shared styles -->
</head>
<body>
  <header>
    <a href="/" class="logo-link" aria-label="PictureThisPet Home">
      <img src="assets/images/headerlogowarm.png" alt="PictureThisPet Logo" class="desktop-logo" />
    </a>
    <nav class="site-nav">
      <a href="/" aria-label="Home page">Home</a>
      <a href="/availability.html" aria-label="Availability page">Availability</a>
      <a href="/locations.html" aria-label="Locations page">Locations</a>
      <a href="/pricing" aria-label="Pricing page">Pricing</a>
      <a href="/contact" aria-label="Contact page">Contact</a>
      <a href="#" class="book-btn" aria-label="Book a session" onclick="scrollToSessionBuilder(event)">Book Now</a>
    </nav>
    <div class="social-icons">
      <a href="https://instagram.com/picturethispet" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Instagram">
        <i class="fab fa-instagram social-icon"></i>
      </a>
    </div>
    <button class="mobile-menu-btn" aria-label="Toggle mobile menu" onclick="toggleMenu()">‚ò∞</button>
  </header>

  <main>
    <!-- Hero Section -->
    <section class="hero-section">
      <div class="hero-content">
        <h1>Timeless Pet Photography in Denver</h1>
        <p>Capture the magic of your furry friends with Picture This Pet. Cherish every moment with stunning, professional photos.</p>
        <a href="#session-builder-section" class="hero-cta" onclick="scrollToSessionBuilder(event)">Book Your Session</a>
      </div>
    </section>

    <!-- Upcoming Pop-Up Events Section -->
    <section id="upcoming-events-section">
      <div class="upcoming-events-container">
        <h2>Upcoming Pop-Up Events</h2>
        <div class="events-grid" id="events-grid">
          <p>No current events at this moment.</p>
        </div>
      </div>
    </section>

    <!-- Session Builder Section -->
    <section id="session-builder-section">
      <div class="session-builder-container">
        <h2>Book Your Pet Photography Session</h2>
        <p>Let's create a session that's perfect for you and your pet. Answer a few quick questions to get started.</p>

        <!-- Start Your Journey Card -->
        <div class="session-builder-card" id="start-journey-card">
          <h3>Start Your Journey</h3>
          <p>Ready to capture your pet's personality?<br>Let's build your perfect photography session in just a few steps.</p>
          <button class="next-btn" onclick="showCard('email-capture-card')">Start Now</button>
        </div>

        <!-- Email Capture Card -->
        <div class="session-builder-card" id="email-capture-card" style="display: none;">
          <h3>What is your email to get started?</h3>
          <p>We'll use this to keep you updated on your booking.</p>
          <div class="form-group">
            <label for="user-email">Email Address *</label>
            <input type="email" id="user-email" name="user-email" required placeholder="Enter your email address" />
          </div>
          <div class="card-actions">
            <button class="back-btn" onclick="showCard('start-journey-card')">Back</button>
            <button class="next-btn" id="email-next" onclick="saveEmailAndProceed()">Next</button>
          </div>
        </div>

        <!-- Session Type Card -->
        <div class="session-builder-card" id="session-type-card" style="display: none;">
          <h3>Choose Your Session Type</h3>
          <p>Select the type of session that best suits your needs.</p>
          <div class="session-details" id="session-details">
            <!-- Session types will be populated dynamically -->
          </div>
          <div class="options" id="session-type-options">
            <!-- Options will be populated dynamically -->
          </div>
          <div class="card-actions">
            <button class="back-btn" onclick="showCard('email-capture-card')">Back</button>
          </div>
        </div>

        <!-- Date/Time Selection Card -->
        <div class="session-builder-card" id="datetime-card" style="display: none;">
          <h3>Select Date and Time</h3>
          <p>Choose an available date and time for your session.</p>
          <div class="form-group">
            <label for="session-date">Date *</label>
            <input type="date" id="session-date" name="session-date" required />
          </div>
          <div class="form-group">
            <label for="session-time">Time *</label>
            <select id="session-time" name="session-time" required>
              <option value="">Select a time</option>
              <!-- Times will be populated dynamically -->
            </select>
          </div>
          <div class="card-actions">
            <button class="back-btn" onclick="showCard('session-type-card')">Back</button>
            <button class="next-btn" onclick="saveDateTimeAndProceed()">Next</button>
          </div>
        </div>

        <!-- Location Card -->
        <div class="session-builder-card" id="location-card" style="display: none;">
          <h3>Select Your Location</h3>
          <p>Choose a scenic Denver park for your pet's photo session.</p>
          <div class="options" id="location-options">
            <!-- Locations will be populated dynamically -->
          </div>
          <div class="card-actions">
            <button class="back-btn" onclick="showCard('datetime-card')">Back</button>
          </div>
        </div>

        <!-- Pet Count Card -->
        <div class="session-builder-card" id="pet-count-card" style="display: none;">
          <h3>How Many Pets?</h3>
          <p>Tell us how many pets will be joining the session (maximum of 2).</p>
          <div class="options">
            <button class="option-btn" data-value="1">1 Pet</button>
            <button class="option-btn" data-value="2">2 Pets</button>
          </div>
          <div class="card-actions">
            <button class="back-btn" onclick="showCard('location-card')">Back</button>
          </div>
        </div>

        <!-- People Count Card -->
        <div class="session-builder-card" id="people-count-card" style="display: none;">
          <h3>How Many People?</h3>
          <p>Will any family members be joining the session? (Maximum of 2 people)</p>
          <div class="options">
            <button class="option-btn" data-value="1">1 Person</button>
            <button class="option-btn" data-value="2">2 People</button>
          </div>
          <div id="lead-capture-success" class="lead-capture-success" style="display: none;">
            ‚úÖ Great! We've saved your session preferences. Continue to complete your booking.
          </div>
          <div class="card-actions">
            <button class="back-btn" onclick="showCard('pet-count-card')">Back</button>
          </div>
        </div>

        <!-- Pet Behavior Policy Card -->
        <div class="session-builder-card" id="pet-behavior-policy-card" style="display: none;">
          <h3>Pet Behavior Policy</h3>
          <div class="policy-content">
            <p>We want to ensure a safe and enjoyable experience for everyone. Please review our pet behavior policy:</p>
            <ul>
              <li>All pets must be vaccinated, and proof may be requested.</li>
              <li>Pets should be comfortable around other animals and people.</li>
              <li>If your pet is off-leash, they must have reliable recall.</li>
              <li>Any aggressive behavior must be disclosed prior to the session.</li>
              <li>We reserve the right to cancel the session if safety is a concern.</li>
            </ul>
            <p>By proceeding, you agree to these terms.</p>
          </div>
          <div class="card-actions">
            <button class="back-btn" onclick="showCard('people-count-card')">Back</button>
            <button class="next-btn" onclick="showCard('vaccination-policy-card')">I Agree, Proceed</button>
          </div>
        </div>

        <!-- Vaccination Policy Card -->
        <div class="session-builder-card" id="vaccination-policy-card" style="display: none;">
          <h3>Vaccination Policy</h3>
          <div class="policy-content">
            <p>We require all pets to be fully vaccinated to ensure the safety of everyone involved. Please review our vaccination policy:</p>
            <ul>
              <li>All pets must be vaccinated against rabies and other common diseases.</li>
              <li>Proof of vaccination may be requested prior to the session.</li>
              <li>Failure to provide proof may result in session cancellation.</li>
            </ul>
            <p>By proceeding, you confirm that your pet is vaccinated and agree to provide proof if requested.</p>
          </div>
          <div class="card-actions">
            <button class="back-btn" onclick="showCard('pet-behavior-policy-card')">Back</button>
            <button class="next-btn" onclick="showCard('cancellation-policy-card')">I Agree, Proceed</button>
          </div>
        </div>

        <!-- Cancellation Policy Card -->
        <div class="session-builder-card" id="cancellation-policy-card" style="display: none;">
          <h3>Cancellation Policy</h3>
          <div class="policy-content">
            <p>We understand that plans can change. Please review our cancellation policy:</p>
            <ul>
              <li>Cancellations must be made at least 48 hours before the scheduled session to receive a full refund.</li>
              <li>No refunds will be issued for cancellations within 48 hours of the session.</li>
              <li>We reserve the right to cancel sessions due to unforeseen circumstances, in which case a full refund will be provided.</li>
            </ul>
            <p>By proceeding, you agree to these cancellation terms.</p>
          </div>
          <div class="card-actions">
            <button class="back-btn" onclick="showCard('vaccination-policy-card')">Back</button>
            <button class="next-btn" onclick="showCard('photo-service-agreement-card')">I Agree, Proceed</button>
          </div>
        </div>

        <!-- Photo Service Agreement Card -->
        <div class="session-builder-card" id="photo-service-agreement-card" style="display: none;">
          <h3>Photo Service Agreement</h3>
          <div class="policy-content">
            <p>Please review our photo service agreement to understand your rights and responsibilities:</p>
            <ul>
              <li>You grant Picture This Pet a non-exclusive license to use the photos for promotional purposes.</li>
              <li>Edited digital images will be delivered within 14 business days after the session.</li>
              <li>The photographer retains copyright of all images but provides you with a personal use license.</li>
              <li>You are responsible for ensuring all participants are prepared and on time for the session.</li>
              <li>Reshoots are at the photographer's discretion and may incur additional fees.</li>
            </ul>
            <p>By proceeding, you agree to these terms.</p>
          </div>
          <div class="card-actions">
            <button class="back-btn" onclick="showCard('cancellation-policy-card')">Back</button>
            <button class="next-btn" onclick="saveSessionDataAndCreateBooking()">I Agree, Book Now</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Instagram Posts Section -->
    <section id="instagram-posts-section">
      <div class="instagram-posts-container">
        <h2>Our Latest Instagram Posts</h2>
        <p>Check out some behind-the-scenes moments and adorable pet highlights from our recent sessions!</p>
        <div class="posts-grid">
          <div class="post-placeholder">Instagram Post 1<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 2<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 3<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 4<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 5<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 6<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 7<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 8<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 9<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 10<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 11<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 12<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 13<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 14<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 15<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 16<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 17<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 18<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 19<br>(Placeholder)</div>
          <div class="post-placeholder">Instagram Post 20<br>(Placeholder)</div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-container">
      <div class="footer-section">
        <h4>Contact Us</h4>
        <a href="mailto:info@picturethispet.co" aria-label="Email us at info@picturethispet.co">Email Us</a>
        <a href="https://picturethispet.co" aria-label="Visit our website picturethispet.co">picturethispet.co</a>
      </div>
      <div class="footer-section socials">
        <h4>Connect</h4>
        <a href="https://instagram.com/picturethispet" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Instagram">Instagram</a>
        <a href="/subscribe" aria-label="Subscribe to our newsletter">Subscribe</a>
      </div>
      <div class="footer-section">
        <h4>We Accept</h4>
        <div class="payment-methods">
          <img src="assets/images/payments/visa.png" alt="Visa payment accepted" class="payment-icon" />
          <img src="assets/images/payments/mastercard.png" alt="MasterCard payment accepted" class="payment-icon" />
          <img src="assets/images/payments/amex.png" alt="American Express payment accepted" class="payment-icon" />
          <img src="assets/images/payments/discover.png" alt="Discover payment accepted" class="payment-icon" />
          <img src="assets/images/payments/applepay.png" alt="Apple Pay payment accepted" class="payment-icon" />
          <img src="assets/images/payments/googlepay.png" alt="Google Pay payment accepted" class="payment-icon" />
          <img src="assets/images/payments/samsungpay.png" alt="Samsung Pay payment accepted" class="payment-icon" />
          <img src="assets/images/payments/amazonpay.png" alt="Amazon Pay payment accepted" class="payment-icon" />
          <img src="assets/images/payments/klarna.png" alt="Klarna payment accepted" class="payment-icon" />
          <img src="assets/images/payments/affirm.png" alt="Affirm payment accepted" class="payment-icon" />
          <img src="assets/images/payments/afterpay.png" alt="Afterpay payment accepted" class="payment-icon" />
          <img src="assets/images/payments/cashapp.png" alt="Cash App payment accepted" class="payment-icon" />
          <img src="assets/images/payments/paypal.png" alt="PayPal payment accepted" class="payment-icon" />
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>¬© 2025 PictureThisPet. All rights reserved. | v4.1.0 | Last updated: 04:06 AM MDT, May 24, 2025 | <a href="/site-creation" style="color: var(--gold); text-decoration: underline;">AI built my site. Find out How!</a></p>
    </div>
  </footer>

  <script src="/scripts/shared.js"></script>
  <script>
    // Mobile menu toggle
    function toggleMenu() {
      const nav = document.querySelector('.site-nav');
      nav.classList.toggle('active');
    }

    // Smooth scroll to session builder
    function scrollToSessionBuilder(e) {
      e.preventDefault();
      const section = document.querySelector('#session-builder-section');
      section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Show specific session builder card and auto-scroll to top
    function showCard(cardId) {
      const cards = document.querySelectorAll('.session-builder-card');
      cards.forEach(card => {
        card.style.display = card.id === cardId ? 'block' : 'none';
      });

      const sessionBuilderSection = document.querySelector('#session-builder-section');
      sessionBuilderSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Fetch session types from Airtable and populate options
    async function fetchSessionTypes() {
      try {
        const data = await fetchAirtableData('SessionTypes', { filterByFormula: '{isActive}=1' });
        const sessionDetails = document.getElementById('session-details');
        const sessionOptions = document.getElementById('session-type-options');

        if (!data.records || data.records.length === 0) {
          sessionDetails.innerHTML = '<p>No session types available at this time.</p>';
          return;
        }

        sessionDetails.innerHTML = data.records.map(record => `
          <div class="session-box">
            <h4>${record.fields.typeName}</h4>
            <ul>
              <li>‚è∞ ${record.fields.duration} minutes</li>
              <li>üì∏ Includes ${record.fields.numImages} edited digital images</li>
              <li>üêæ 1 pet included</li>
              <li>üë§ 1 person included</li>
              <li>üíµ Additional pets or people at extra cost</li>
            </ul>
          </div>
        `).join('');

        sessionOptions.innerHTML = data.records.map(record => `
          <button class="option-btn" data-value="${record.fields.typeName}">${record.fields.typeName}</button>
        `).join('');
      } catch (error) {
        console.error('Error fetching session types:', error);
        logErrorToAirtable('index.html', error);
        document.getElementById('session-details').innerHTML = '<p>Error loading session types. Please try again later.</p>';
      }
    }

    // Fetch locations from Airtable and populate options
    async function fetchLocations() {
      try {
        const data = await fetchAirtableData('Locations');
        const locationOptions = document.getElementById('location-options');

        if (!data.records || data.records.length === 0) {
          locationOptions.innerHTML = '<p>No locations available at this time.</p>';
          return;
        }

        locationOptions.innerHTML = data.records.map(record => `
          <button class="option-btn" data-value="${record.fields.locationName}">${record.fields.locationName}</button>
        `).join('');
      } catch (error) {
        console.error('Error fetching locations:', error);
        logErrorToAirtable('index.html', error);
        document.getElementById('location-options').innerHTML = '<p>Error loading locations. Please try again later.</p>';
      }
    }

    // Fetch available times for a selected date
    async function fetchAvailableTimes(date) {
      try {
        const timeSelect = document.getElementById('session-time');
        timeSelect.innerHTML = '<option value="">Select a time</option>';

        const data = await fetchAirtableData('Calendar', {
          filterByFormula: `AND({date}="${date}", {status}="available", {isBlocked}=0, {isAvailable}=1)`
        });

        if (!data.records || data.records.length === 0) {
          timeSelect.innerHTML += '<option value="" disabled>No available times for this date</option>';
          return;
        }

        const times = [...new Set(data.records.map(record => record.fields.time))].sort();
        timeSelect.innerHTML += times.map(time => `
          <option value="${time}">${time}</option>
        `).join('');
      } catch (error) {
        console.error('Error fetching available times:', error);
        logErrorToAirtable('index.html', error);
        alert('Error loading available times. Please try again.');
      }
    }

    // Save email and proceed to the next card
    function saveEmailAndProceed() {
      const emailInput = document.getElementById('user-email');
      const email = emailInput.value;

      if (!email || !emailInput.checkValidity()) {
        alert('Please enter a valid email address.');
        return;
      }

      try {
        let marketingData = JSON.parse(localStorage.getItem('ptpMarketingData')) || {};
        marketingData.email = email;
        const marketingString = JSON.stringify(marketingData);
        localStorage.setItem('ptpMarketingData', marketingString);
        localStorage.setItem('ptpMarketingBackup', marketingString);
        sessionStorage.setItem('ptpMarketingData', marketingString);
        sessionStorage.setItem('ptpMarketingBackup', marketingString);
        console.log('‚úÖ Marketing data saved redundantly in 4 locations');

        let sessionData = JSON.parse(localStorage.getItem('ptpSessionData')) || {};
        sessionData.email = email;
        const sessionString = JSON.stringify(sessionData);
        localStorage.setItem('ptpSessionData', sessionString);
        localStorage.setItem('ptpSessionBackup', sessionString);
        sessionStorage.setItem('ptpSessionData', sessionString);
        sessionStorage.setItem('ptpSessionBackup', sessionString);
        console.log('‚úÖ Session data updated with email and saved redundantly in 4 locations');
      } catch (error) {
        console.error('Error saving email:', error);
        logErrorToAirtable('index.html', error, { email });
      }

      showCard('session-type-card');
    }

    // Save date/time and proceed to the next card
    function saveDateTimeAndProceed() {
      const dateInput = document.getElementById('session-date');
      const timeSelect = document.getElementById('session-time');
      const date = dateInput.value;
      const time = timeSelect.value;

      if (!date || !time) {
        alert('Please select both a date and a time.');
        return;
      }

      let sessionData = JSON.parse(localStorage.getItem('ptpSessionData')) || {};
      sessionData.selectedDate = date;
      sessionData.selectedTime = time;
      sessionData.sessionDate = `${date}T${time}:00`;

      try {
        const dataString = JSON.stringify(sessionData);
        localStorage.setItem('ptpSessionData', dataString);
        localStorage.setItem('ptpSessionBackup', dataString);
        sessionStorage.setItem('ptpSessionData', dataString);
        sessionStorage.setItem('ptpSessionBackup', dataString);
        console.log('‚úÖ Session data updated with date/time and saved redundantly in 4 locations');
      } catch (error) {
        console.error('Error saving date/time:', error);
        logErrorToAirtable('index.html', error, sessionData);
      }

      showCard('location-card');
    }

    // Handle option selection with auto-advance
    function handleOptionSelection(optionGroup, nextCardId) {
      const options = document.querySelectorAll(`#${optionGroup} .option-btn`);

      options.forEach(option => {
        option.addEventListener('click', function() {
          options.forEach(btn => btn.classList.remove('selected'));
          this.classList.add('selected');

          let sessionData = JSON.parse(localStorage.getItem('ptpSessionData')) || {};
          if (optionGroup === 'session-type-card') sessionData.session = this.dataset.value;
          if (optionGroup === 'location-card') sessionData.park = this.dataset.value;
          if (optionGroup === 'pet-count-card') sessionData.petCount = this.dataset.value;
          if (optionGroup === 'people-count-card') {
            sessionData.peopleCount = this.dataset.value;
            const successMessage = document.getElementById('lead-capture-success');
            successMessage.style.display = 'block';
            setTimeout(() => {
              successMessage.style.display = 'none';
            }, 3000);
          }

          try {
            const dataString = JSON.stringify(sessionData);
            localStorage.setItem('ptpSessionData', dataString);
            localStorage.setItem('ptpSessionBackup', dataString);
            sessionStorage.setItem('ptpSessionData', dataString);
            sessionStorage.setItem('ptpSessionBackup', dataString);
            console.log('‚úÖ Session data updated and saved redundantly in 4 locations');
          } catch (error) {
            console.error('Error saving session data:', error);
            logErrorToAirtable('index.html', error, sessionData);
          }

          showCard(nextCardId);
        });
      });
    }

    // Save session data and create booking after agreement
    async function saveSessionDataAndCreateBooking() {
      let sessionData = JSON.parse(localStorage.getItem('ptpSessionData')) || {};
      sessionData.session = document.querySelector('#session-type-card .option-btn.selected')?.dataset.value || '';
      sessionData.park = document.querySelector('#location-card .option-btn.selected')?.dataset.value || '';
      sessionData.petCount = document.querySelector('#pet-count-card .option-btn.selected')?.dataset.value || '';
      sessionData.peopleCount = document.querySelector('#people-count-card .option-btn.selected')?.dataset.value || '';
      sessionData.bookingId = `BOOKING_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
      sessionData.timestamp = new Date().toISOString();

      try {
        // Fetch the selected slot to get its ID
        const slotData = await fetchAirtableData('Calendar', {
          filterByFormula: `AND({date}="${sessionData.selectedDate}", {time}="${sessionData.selectedTime}", {status}="available", {isBlocked}=0, {isAvailable}=1)`
        });

        if (!slotData.records || slotData.records.length === 0) {
          throw new Error('Selected slot is no longer available.');
        }

        const slotId = slotData.records[0].id;

        // Create booking in Airtable
        const bookingRecord = {
          fields: {
            bookingId: sessionData.bookingId,
            timestamp: sessionData.timestamp,
            status: 'confirmed',
            email: sessionData.email,
            sessionType: sessionData.session,
            location: sessionData.park,
            petCount: parseInt(sessionData.petCount) || 1,
            peopleCount: parseInt(sessionData.peopleCount) || 1,
            sessionDate: sessionData.sessionDate,
            calendarSlot: [slotId]
          }
        };

        const bookingResult = await createAirtableRecord('Bookings', bookingRecord);
        console.log('‚úÖ Booking created:', bookingResult);

        // Update the calendar slot to booked
        const updateSlotResponse = await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/Calendar/${slotId}`, {
          method: 'PATCH',
          headers: {
            'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            fields: {
              status: 'booked',
              bookingId: [bookingResult.id]
            }
          })
        });

        if (!updateSlotResponse.ok) {
          throw new Error('Failed to update calendar slot.');
        }

        console.log('‚úÖ Calendar slot updated to booked');

        // Save redundantly to localStorage and sessionStorage
        const dataString = JSON.stringify(sessionData);
        localStorage.setItem('ptpSessionData', dataString);
        localStorage.setItem('ptpSessionBackup', dataString);
        localStorage.setItem(`ptpBooking_${sessionData.bookingId}`, dataString);
        sessionStorage.setItem('ptpSessionData', dataString);
        sessionStorage.setItem('ptpSessionBackup', dataString);
        console.log('‚úÖ Session data saved redundantly in 5 locations');

        alert('üéâ Your session has been booked successfully! We‚Äôll send a confirmation to your email.');
        window.location.href = '/client-portal-home.html';

      } catch (error) {
        console.error('Error creating booking:', error);
        logErrorToAirtable('index.html', error, sessionData);
        alert('‚ùå Error creating your booking. Please try again.');
      }
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('üöÄ Session builder loaded with Airtable connection...');

      await fetchSessionTypes();
      await fetchLocations();

      document.getElementById('session-date').addEventListener('change', function() {
        fetchAvailableTimes(this.value);
      });

      handleOptionSelection('session-type-card', 'datetime-card');
      handleOptionSelection('location-card', 'pet-count-card');
      handleOptionSelection('pet-count-card', 'people-count-card');
      handleOptionSelection('people-count-card', 'pet-behavior-policy-card');
    });
  </script>
</body>
</html>
